<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ElasticSearch | goMars的学习随记</title><meta name="keywords" content="ElasticSearch 搜索引擎 ES"><meta name="author" content="goMars,wht661024@163.com"><meta name="copyright" content="goMars"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ElasticSearch简介Elasticsearch 是一个分布式、可扩展、实时的搜索与数据分析引擎，建立在一个全文搜索引擎库 Apache Lucene™基础之上，是整个 ElasticStack 技术栈的核心。ES是采用java语言编写，提供了简单易用的RestFul API，开发者可以使用其简单的RestFul API，开发相关的搜索功能，从而避免lucene的复杂性。 优点：  一个分">
<meta property="og:type" content="article">
<meta property="og:title" content="ElasticSearch">
<meta property="og:url" content="http://example.com/2023/03/11/%E4%B8%AD%E9%97%B4%E4%BB%B6/Elasticsearch/ElasticSearch/index.html">
<meta property="og:site_name" content="goMars的学习随记">
<meta property="og:description" content="ElasticSearch简介Elasticsearch 是一个分布式、可扩展、实时的搜索与数据分析引擎，建立在一个全文搜索引擎库 Apache Lucene™基础之上，是整个 ElasticStack 技术栈的核心。ES是采用java语言编写，提供了简单易用的RestFul API，开发者可以使用其简单的RestFul API，开发相关的搜索功能，从而避免lucene的复杂性。 优点：  一个分">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/yoshiko.jpg">
<meta property="article:published_time" content="2023-03-11T01:43:33.000Z">
<meta property="article:modified_time" content="2023-04-21T01:15:11.168Z">
<meta property="article:author" content="goMars">
<meta property="article:tag" content="ElasticSearch">
<meta property="article:tag" content="搜索引擎">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/yoshiko.jpg"><link rel="shortcut icon" href="/img/favicon2.png"><link rel="canonical" href="http://example.com/2023/03/11/%E4%B8%AD%E9%97%B4%E4%BB%B6/Elasticsearch/ElasticSearch/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-21 09:15:11'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        })(window)</script><link rel="stylesheet" href="/css/shadow.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/hideCategory.min.css"><meta name="generator" content="Hexo 5.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/blogphoto2.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">157</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">83</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">48</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa-fw fa fa-book"></i><span> 找文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/yoshiko.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">goMars的学习随记</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa-fw fa fa-book"></i><span> 找文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ElasticSearch</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-03-11T01:43:33.000Z" title="发表于 2023-03-11 09:43:33">2023-03-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-04-21T01:15:11.168Z" title="更新于 2023-04-21 09:15:11">2023-04-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/ElasticSearch/">ElasticSearch</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Elasticsearch 是一个分布式、可扩展、实时的搜索与数据分析引擎，建立在一个全文搜索引擎库 Apache Lucene™基础之上，是整个 ElasticStack 技术栈的核心。ES是采用java语言编写，提供了简单易用的RestFul API，开发者可以使用其简单的RestFul API，开发相关的搜索功能，从而避免lucene的复杂性。</p>
<p><strong>优点：</strong></p>
<ul>
<li>一个分布式的实时文档存储，<em>每个字段</em>可以被索引与搜索</li>
<li>一个分布式实时分析搜索引擎</li>
<li>能胜任上百个服务节点的扩展，并支持 PB 级别的结构化或者非结构化数据</li>
</ul>
<blockquote>
<p>ElasticStack ：包括 Elasticsearch、 Kibana、 Beats 和 Logstash（也称为 ELK Stack）</p>
</blockquote>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="Docker方式安装"><a href="#Docker方式安装" class="headerlink" title="Docker方式安装"></a>Docker方式安装</h3><ol>
<li><p>获取镜像：<code>docker pull elasticsearch:7.14.0</code></p>
</li>
<li><p>创建数据目录：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/docker_app/elasticsearch/config</span><br><span class="line">mkdir -p /opt/docker_app/elasticsearch/logs</span><br><span class="line">mkdir -p /opt/docker_app/elasticsearch/data</span><br><span class="line">mkdir -p /opt/docker_app/elasticsearch/plugins</span><br></pre></td></tr></table></figure></li>
<li><p>创建配置文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;http.host: 0.0.0.0&quot;&gt;&gt;/opt/docker_app/elasticsearch/config/elasticsearch.yml</span><br></pre></td></tr></table></figure></li>
<li><p>系统配置修改：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br><span class="line">vm.max_map_count=655360</span><br><span class="line">sysctl -p /etc/sysctl.conf/</span><br></pre></td></tr></table></figure></li>
<li><p>创建容器：(注意不能用root用户启动)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms1g -Xmx2g&quot; --restart=always -v /opt/docker_app/elasticsearch/config/elasticsearch.yml:/config/elasticsearch.yml -v /opt/docker_app/elasticsearch/data:/elasticsearch/data -v /opt/docker_app/elasticsearch/plugins:/elasticsearch/plugins -v /opt/docker_app/elasticsearch/logs:/elasticsearch/logs -d elasticsearch:7.14.0</span><br></pre></td></tr></table></figure></li>
<li><p>检查是否连接成功：浏览器输入<a target="_blank" rel="noopener" href="http://ip:9200/">http://ip:9200</a></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/image-20220914183156571.png" alt="image-20220914183156571"></p>
</li>
<li><p>安装成功</p>
</li>
</ol>
<h2 id="Kibana"><a href="#Kibana" class="headerlink" title="Kibana"></a>Kibana</h2><p>Kibana是一个针对Elasticsearch的开源分析及可视化平台，使用Kibana可以查询、查看并与存储在ES索引的数据进行交互操作，使用Kibana能执行高级的数据分析，并能以图表、表格和地图的形式查看数据。（当然如果对esAPI很熟悉的话可以使用postman）</p>
<h3 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h3><ol>
<li><p>拉取镜像：<code>docker pull kibana:7.14.0</code></p>
</li>
<li><p>创建数据目录以及配置文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/docker_app/kibana/config </span><br><span class="line">vim kibana.yml</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置内容：</span></span><br><span class="line">server.host: &quot;0.0.0.0&quot;</span><br><span class="line">server.shutdownTimeout: &quot;5s&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash">集群</span></span><br><span class="line">elasticsearch.hosts: [ &quot;http://localhost:9200&quot; ]</span><br><span class="line"><span class="meta">#</span><span class="bash">elasticsearch中用户名和密码</span></span><br><span class="line"><span class="meta">#</span><span class="bash">elasticsearch.username: <span class="string">&quot;kibana_system&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">elasticsearch.password: <span class="string">&quot;JNeepMbbA0inbAI8voK3&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">设置kibana中文显示</span></span><br><span class="line">i18n.locale: zh-CN</span><br></pre></td></tr></table></figure></li>
<li><p>启动容器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name=kibana -p 5601:5601 --restart=always -v /opt/docker_app/kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml kibana:7.14.0</span><br></pre></td></tr></table></figure></li>
<li><p>进入kibana：<a target="_blank" rel="noopener" href="http://ip:5601/">http://ip:5601</a></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/image-20220914201331121.png" alt="image-20220914201331121"></p>
</li>
</ol>
<h4 id="设置密码"><a href="#设置密码" class="headerlink" title="设置密码"></a>设置密码</h4><h5 id="设置es密码"><a href="#设置es密码" class="headerlink" title="设置es密码"></a>设置es密码</h5><ul>
<li><p>在配置文件中进行配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">http.cors.allow-headers: Authorization</span><br><span class="line">xpack.security.enabled: true</span><br><span class="line">xpack.security.transport.ssl.enabled: true</span><br></pre></td></tr></table></figure></li>
<li><p>进入容器执行<code>./bin/elasticsearch-setup-passwords interactive</code></p>
</li>
<li><p>期间设置各种账号密码</p>
<blockquote>
<p>账号：</p>
<ul>
<li>elastic：超级管理员账号</li>
<li>kibana：Kibana访问专用账号</li>
<li>logstash_system：Logstash访问专用账号</li>
<li>beats_system：FileBeat访问专用账号</li>
<li>apm_system：APM系统专用账号</li>
<li>remote_monitoring_user：远程监控账号</li>
</ul>
</blockquote>
</li>
<li><p>此时进入es就需要输入账号密码了（可以选择上面注册的各种账号密码）</p>
</li>
</ul>
<h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引<Index></h3><p>一个索引就是一个拥有几分相似特征的文档的集合，一个 索引 类似于传统关系数据库中的一个 数据库 ，是一个存储关系型文档的地方。比如说，你可以有一个商品数据的索引，一个订单数据的索引，还有一个用户数据的索引。一个索引由一个名字来标识（必须全部是小写字母的)，并且当我们要对这个索引中的文档进行索引、搜索、更新和删除的时候，都要使用到这个名字。</p>
<h3 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射<Mapping></h3><p>映射是定义一个文档和它所包含的字段如何被存储和索引的过程。在默认配置下，ES可以根据插入的数据自动地创建mapping，也可以手动创建mapping。mapping中主要包括字段名、字段类型等</p>
<h3 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档<Document></h3><p>文档是索引中存储的一条条数据。一条文档是一个可被索引的最小单元。ES中的文档采用了轻量级的JSON格式数据来表示。</p>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><h3 id="索引操作"><a href="#索引操作" class="headerlink" title="索引操作"></a>索引操作</h3><ul>
<li><p>创建索引：<code>PUT /索引名</code>（默认ES在创建索引时会为索引创建1个备份索引和一个primary索引）</p>
<ul>
<li><p>例子：<code>PUT /products</code></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/image-20220914205524808.png" alt="image-20220914205524808"></p>
<p>由于主索引和备份索引在同一台机器上（这样并不安全），所以当前索引状态为yellow</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">可以不创建备份索引：</span></span><br><span class="line">PUT /goods</span><br><span class="line">&#123;</span><br><span class="line">	&quot;settings&quot;:&#123;</span><br><span class="line">		&quot;number_of_shards&quot;: 1,</span><br><span class="line">		&quot;number_of_replicas&quot;: 0</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/image-20220914210033118.png" alt="image-20220914210033118"></p>
<blockquote>
<p>ES中索引健康转态red(索引不可用)、yellwo(索引可用,存在风险)、green(健康)</p>
</blockquote>
</li>
</ul>
</li>
<li><p>查看es中所有索引：<code>GET /_cat/indices</code>或者<code>GET /_cat/indices?v</code>(带上标题)</p>
</li>
<li><p>删除索引：<code>DELETE /索引名</code></p>
</li>
</ul>
<h3 id="映射操作"><a href="#映射操作" class="headerlink" title="映射操作"></a>映射操作</h3><ul>
<li><p>创建映射（创建索引时一起创建）</p>
<ul>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">创建索引以及映射</span></span><br><span class="line">PUT /products</span><br><span class="line">&#123;</span><br><span class="line">	&quot;settings&quot;:&#123;</span><br><span class="line">		&quot;number_of_shards&quot;: 1,</span><br><span class="line">		&quot;number_of_replicas&quot;: 0</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;mappings&quot;: &#123;</span><br><span class="line">	  &quot;properties&quot;: &#123;</span><br><span class="line">	    &quot;id&quot;:&#123;</span><br><span class="line">	      &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">	    &#125;,</span><br><span class="line">	    &quot;title&quot;:&#123;</span><br><span class="line">	      &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">	    &#125;,</span><br><span class="line">	    &quot;price&quot;:&#123;</span><br><span class="line">	      &quot;type&quot;: &quot;double&quot;</span><br><span class="line">	    &#125;,</span><br><span class="line">	    &quot;created_at&quot;:&#123;</span><br><span class="line">	      &quot;type&quot;: &quot;date&quot;</span><br><span class="line">	    &#125;,</span><br><span class="line">	    &quot;description&quot;:&#123;</span><br><span class="line">	      &quot;type&quot;: &quot;text&quot;</span><br><span class="line">	    &#125;</span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>映射类型：</strong></p>
<ul>
<li>字符串类型：keyword关键词、text文本</li>
<li>数字类型：intrger、long</li>
<li>小数类型：float、double</li>
<li>布尔类型：boolean</li>
<li>日期类型：date</li>
<li>IPv4及IPv6地址类型：ip</li>
<li>自动判断字段类型：Auto</li>
<li>Nested：嵌套对象类型</li>
<li>….更多查看<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.15/mapping-types.html">官网</a></li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li><p>查看索引的映射信息：<code>GET /索引名/_mapping</code></p>
</li>
</ul>
<h3 id="文档操作"><a href="#文档操作" class="headerlink" title="文档操作"></a>文档操作</h3><ul>
<li><p>添加文档：<code>POST /索引名/_doc/[id]</code></p>
<ul>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">自动生成文档_id方式</span></span><br><span class="line">POST /products/_doc/</span><br><span class="line">&#123;</span><br><span class="line">	&quot;title&quot; : &quot;可口可乐&quot; ,</span><br><span class="line">	&quot;price&quot;: 3.5,</span><br><span class="line">	&quot;created_at&quot; : &quot;2022-09-15&quot;，</span><br><span class="line">	&quot;description&quot; : &quot;肥宅快乐水&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">指定义文档_id</span></span><br><span class="line">POST /products/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">	&quot;id&quot;: 1</span><br><span class="line">	&quot;title&quot; : &quot;卫龙小辣棒&quot; ,</span><br><span class="line">	&quot;price&quot;: 6.2,</span><br><span class="line">	&quot;created_at&quot; : &quot;2022-09-15&quot;,</span><br><span class="line">	&quot;description&quot; : &quot;辣条&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>查询文档：<code>GET /索引名/_doc/_id值</code></p>
</li>
<li><p>删除文档：<code>DELETE /索引名/_doc/_id值</code></p>
</li>
<li><p>更新文档：</p>
<ul>
<li><p>方式一：<code>PUT /索引名/_doc/_id值&#123;文档内容&#125;</code>(这种方式会删除原来的文档，重新添加)</p>
</li>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 更新文档</span></span><br><span class="line">PUT /products/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">	&quot;price&quot;:6.5</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>方式二：</p>
</li>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 更新文档2</span></span><br><span class="line">POST /products/_doc/1/_update</span><br><span class="line">&#123;   </span><br><span class="line">  &quot;doc&quot;:&#123;</span><br><span class="line">    &quot;price&quot;:4.8</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>批量操作：<code>POST /索引名/_doc/_bulk&#123;操作数据&#125;</code></p>
<ul>
<li><p>例子1批量插入(注意数据不能换行)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;products&#x2F;_doc&#x2F;_bulk</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:2&#125;&#125;</span><br><span class="line">  &#123;&quot;id&quot;: 2,&quot;title&quot; : &quot;百事可乐&quot; ,&quot;price&quot;: 3.0,&quot;created_at&quot; : &quot;2022-09-15&quot;,&quot;description&quot; : &quot;肥宅快乐水02&quot;&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:3&#125;&#125;</span><br><span class="line">  &#123;&quot;id&quot;: 3,&quot;title&quot; : &quot;乐事薯片&quot; ,&quot;price&quot;: 6.9,&quot;created_at&quot; : &quot;2022-09-15&quot;,&quot;description&quot; : &quot;看电视时吃&quot;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>例子2批量各种操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">批量添加更新删除</span></span><br><span class="line">POST /products/_doc/_bulk</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:4&#125;&#125;</span><br><span class="line">  &#123;&quot;id&quot;: 4,&quot;title&quot; : &quot;口香糖&quot; ,&quot;price&quot;: 9.9,&quot;created_at&quot; : &quot;2022-09-15&quot;,&quot;description&quot; : &quot;清新口气&quot;&#125;</span><br><span class="line">&#123;&quot;update&quot;:&#123;&quot;_id&quot;:3&#125;&#125;</span><br><span class="line">  &#123;&quot;doc&quot;:&#123;&quot;price&quot;:7.9&#125;&#125;</span><br><span class="line">&#123;&quot;delete&quot;:&#123;&quot;_id&quot;:2&#125;&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明:批量时不会因为一个失败而全部失败,而是继续执行后续操作,在返回时按照执行的状态返回!</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="高级查询"><a href="#高级查询" class="headerlink" title="高级查询"></a>高级查询</h2><h3 id="DSL查询"><a href="#DSL查询" class="headerlink" title="DSL查询"></a>DSL查询</h3><p>ES中提供了一种强大的检索数据方式,这种检索方式称之为<code>Query DSL</code><DomainSpecified Language>，查询表达式(Query DSL)是一种非常灵活又富有表现力的查询语言，Query DSL是利用Rest API传递JSON格式的请求体(RequestBody)数据与ES进行交互，这种方式的丰富查询语法让ES检索变得更强大，更简洁。</p>
<p><strong>基础语法：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /索引名/_search &#123;json格式请求体数据&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>查询所有：使用<code>match_all</code>来表示</p>
<ul>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">查询所有</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;match_all&quot;:&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>关键词查询：使用<code>term</code>进行查询</p>
<ul>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 条件查询02</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &#123;</span><br><span class="line">      	&quot;value&quot;:&quot;可口可乐&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>keyword、integer、double等除text类型需要精确匹配，text类型由于采用标准分词器，按照单字单词分词所以只能按照单字单词查询。</p>
</blockquote>
</li>
</ul>
</li>
<li><p>条件查询：使用<code>match</code>表示匹配条件</p>
<ul>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 条件查询</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;price&quot;: 3.5</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>对于数值类型<code>match</code>操作使用的是精确匹配，对于text文本类型使用的是模糊匹配。</p>
</blockquote>
</li>
</ul>
</li>
<li><p>范围查询：使用<code>range</code>来指定范围</p>
<ul>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 范围查询 gt大于/gte大于等于/lt小于/lte小于等于</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;range&quot;: &#123;</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;gte&quot;: 1,</span><br><span class="line">        &quot;lte&quot;: 10</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>前缀查询：使用<code>prefix</code>表示前缀(依然根据关键词查询)</p>
<ul>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">前缀查询</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;prefix&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;乐事&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>通配符查询：使用<code>wildcard</code>表示使用通配符查询（<code>*</code>代表多个任意字符<code>?</code>代表一个字符）</p>
<ul>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">通配符查询</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;wildcard&quot;: &#123;</span><br><span class="line">      &quot;description&quot;:&#123;</span><br><span class="line">        &quot;value&quot;: &quot;看*&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>根据_id查询：使用<code>ids</code>根据多个id查询</p>
<ul>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 根据_id查询</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;ids&quot;: &#123;</span><br><span class="line">      &quot;values&quot;: [1,2,3]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>模糊查询：使用<code>fuzzy</code>表示模糊查询</p>
<ul>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">模糊查询</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;fuzzy&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;乐事&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意: <code>fuzzy</code>模糊查询最大模糊错误必须在0-2之间</p>
<ul>
<li>搜索关键词长度为2不允许存在模糊</li>
<li>搜索关键词长度为3-5允许一次模糊</li>
<li>搜索关键词长度大于5允许最大2模糊</li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li><p>布尔查询：使用<code>bool</code>来组合多个条件实现复杂查询</p>
<ul>
<li><p>关键字：</p>
<ul>
<li><code>must</code>：相当于与，表示同时满足</li>
<li><code>should</code>：相当于或，表示满足其中任意一个</li>
<li><code>must_not</code>：相当于非，表示同时不满足</li>
</ul>
</li>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">布尔查询</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;ids&quot;: &#123;&quot;values&quot;: [1,3,5]&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;prefix&quot;: &#123;</span><br><span class="line">            &quot;title&quot;: &#123;</span><br><span class="line">              &quot;value&quot;: &quot;乐事&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>多字段查询：使用<code>multi_match</code>表示根据多字段查询（multi_match同match一样text进行模糊查询，其他进行精确查询）</p>
<ul>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">多字段查询</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &quot;乐事&quot;,</span><br><span class="line">      &quot;price&quot;: 3.5</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>默认字段分词查询：使用<code>query_string</code>开启默认字段分词查询（如果之前分词就按照分词查找，不分词就按照不分词来查找）</p>
<ul>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">默认字段分词查询</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      &quot;default_field&quot;: &quot;title&quot;,</span><br><span class="line">      &quot;query&quot;: &quot;乐事薯片&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>高亮查询：使用<code>highlight</code>可以让符合条件的文档中的关键词高亮</p>
<ul>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">高亮查询</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      &quot;default_field&quot;: &quot;description&quot;,</span><br><span class="line">      &quot;query&quot;: &quot;电视快乐睡&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line"><span class="meta">  	#</span><span class="bash"> 设置前置标签默认为&lt;em&gt;</span></span><br><span class="line">    &quot;pre_tags&quot;: [&quot;&lt;span style=&#x27;color:red;&#x27;&gt;&quot;], </span><br><span class="line">    # 设置后置标签默认为&lt;/em&gt;</span><br><span class="line">    &quot;post_tags&quot;: [&quot;&lt;/span&gt;&quot;],</span><br><span class="line">    # 设置字段匹配的校验默认只能是text字段，但是必须能够分词才行</span><br><span class="line">    &quot;require_field_match&quot;: &quot;false&quot;, </span><br><span class="line">    # 规定哪些字段高亮</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;*&quot;:&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/image-20220915215124736.png" alt="image-20220915215124736"></p>
</li>
</ul>
</li>
<li><p>分页查询：使用<code>size</code>和<code>from</code>来控制分页大小</p>
<ul>
<li><p>关键字：</p>
<ul>
<li><code>size</code>：指定查询结果中的返回条数</li>
<li><code>from</code>：用来指定起始返回位置</li>
</ul>
</li>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">分页</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      &quot;default_field&quot;: &quot;description&quot;,</span><br><span class="line">      &quot;query&quot;: &quot;电视快乐睡&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;pre_tags&quot;: [&quot;&lt;span style=&#x27;color:red;&#x27;&gt;&quot;], </span><br><span class="line">    &quot;post_tags&quot;: [&quot;&lt;/span&gt;&quot;],</span><br><span class="line">    &quot;require_field_match&quot;: &quot;false&quot;, </span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;*&quot;:&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ,</span><br><span class="line">  &quot;size&quot;: 1,</span><br><span class="line">  &quot;from&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>指定排序：使用<code>sort</code>表示进行排序，并用<code>order</code>指定降序还是升序</p>
<ul>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">指定排序</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;match_all&quot;:&#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>指定返回字段：使用<code>_source</code>指明要返回的字段</p>
<ul>
<li><p>例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 指定返回字段</span></span><br><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;match_all&quot;:&#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [</span><br><span class="line">    &quot;description&quot;, &quot;title&quot; </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="过滤查询"><a href="#过滤查询" class="headerlink" title="过滤查询"></a>过滤查询</h3></li>
</ul>
</li>
</ul>
<p>过滤查询<filter query>，其实准确来说，ES中的查询操作分为2种:查询(query)和过滤(filter)。查询即是之前提到的Query DSL 查询，它(查询)默认会计算每个返回文档的得分，然后根据得分排序。而过滤(filter)只会筛选出符合的文档，并不计算得分，而且它可以缓存文档。</p>
<p>所以，单从性能考虑，过滤比查询更快。换句话说过滤适合在大范围筛选数据，而查询则适合精确匹配数据。一般应用时，应先使用过滤操作过滤数据，然后使用查询匹配数据。</p>
<p><strong>基础语法：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET /索引/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;&quot;match_all&quot;: &#123;&#125;&#125; //查询条件</span><br><span class="line">      ],</span><br><span class="line">      #过滤条件（会在query之前执行，并且ES会缓存经常使用的过滤器）</span><br><span class="line">      &quot;filter&quot;: &#123;...&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>term、terms过滤器：根据关键词过滤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用term过滤</span></span><br><span class="line">GET /products/_search   </span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;&quot;term&quot;: &#123;</span><br><span class="line">          &quot;name&quot;: &#123;</span><br><span class="line">            &quot;value&quot;: &quot;可口可乐&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;term&quot;: &#123;</span><br><span class="line">          &quot;description&quot;:&quot;好吃&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用terms过滤</span></span><br><span class="line">GET /products/_search  </span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;&quot;term&quot;: &#123;</span><br><span class="line">          &quot;name&quot;: &#123;</span><br><span class="line">            &quot;value&quot;: &quot;可口可乐&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;terms&quot;: &#123;</span><br><span class="line">          &quot;description&quot;:[&quot;饮料&quot;,&quot;好吃&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>ranage过滤器：根据范围过滤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ranage过滤器</span></span><br><span class="line">GET /products/_search  </span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;&quot;term&quot;: &#123;</span><br><span class="line">          &quot;name&quot;: &#123;</span><br><span class="line">            &quot;value&quot;: &quot;可口可乐&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;ranage&quot;: &#123;</span><br><span class="line">          &quot;price&quot;: &#123;</span><br><span class="line">            &quot;gte&quot;: 0,</span><br><span class="line">            &quot;lte&quot;: 5.2</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>exists过滤器：过滤存在指定字段,获取字段不为空的索引记录使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> exists过滤器</span></span><br><span class="line">GET /products/_search  </span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;&quot;term&quot;: &#123;</span><br><span class="line">          &quot;name&quot;: &#123;</span><br><span class="line">            &quot;value&quot;: &quot;可口可乐&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;exists&quot;: &#123;</span><br><span class="line">          &quot;field&quot;:&quot;price&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>ids过滤器：过滤含有指定_id的索引记录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ids过滤器</span></span><br><span class="line">GET /products/_search  </span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;&quot;term&quot;: &#123;</span><br><span class="line">          &quot;name&quot;: &#123;</span><br><span class="line">            &quot;value&quot;: &quot;可口可乐&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;ids&quot;: &#123;</span><br><span class="line">          &quot;values&quot;: [&quot;1&quot;,&quot;2&quot;,&quot;3&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h3><p>聚合︰<strong>英文为Aggregation Aggs，是es除搜索功能外提供的针对es数据做统计分析的功能</strong>。聚合有助于根据搜索查询提供聚合数据。聚合查询是数据库中重要的功能特性，ES作为搜索引擎兼数据库，同样提供了强大的聚合分析能力。它基于查询条件来对数据进行分桶、计算的方法。有点类似于SQL中的group by再加一些函数方法的操作。</p>
<blockquote>
<p>注意：text类型不支持聚合查询</p>
</blockquote>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><ul>
<li><p>根据某个字段进行分组</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  , &quot;aggs&quot;: &#123;</span><br><span class="line"><span class="meta">  	#</span><span class="bash"> 分组名称（自定义）</span></span><br><span class="line">    &quot;price_group&quot;: &#123;</span><br><span class="line">      # 分组字段</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;price&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/image-20220921215721643.png" alt="image-20220921215721643" style="zoom:67%;" />
</li>
<li><p>求最大/小值：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  , &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;max_price&quot;: &#123;</span><br><span class="line">      &quot;max/min&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;price&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/image-20220921215943972.png" alt="image-20220921215943972" style="zoom:67%;" />
</li>
<li><p>求平均值：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  , &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;avg_price&quot;: &#123;</span><br><span class="line">      &quot;avg&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;price&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/image-20220921220130957.png" alt="image-20220921220130957" style="zoom:67%;" />

</li>
</ul>
<h2 id="分词器"><a href="#分词器" class="headerlink" title="分词器"></a>分词器</h2><h3 id="Analysis和Analyzer"><a href="#Analysis和Analyzer" class="headerlink" title="Analysis和Analyzer"></a>Analysis和Analyzer</h3><p>Analysis∶文本分析是把全文本转换一系列单词(term/token)的过程，也叫分词。</p>
<p>Analysis是通过Analyzer来实现的。分词就是将文档通过Analyzer分成一个一个的Term,每一个Term都指向包含这个Term的文档。</p>
<h4 id="Analyzer组成"><a href="#Analyzer组成" class="headerlink" title="Analyzer组成"></a>Analyzer组成</h4><p>在ES中默认使用标准分词器: StandardAnalyzer，其会将中文分为一个字一个字，将英文分为一个单词一个单词。</p>
<p>Analyzer主要由三个部分组成：<code>character filters </code>、<code>tokenizers</code>、<code>token filters</code></p>
<ul>
<li><p><strong>character filters：</strong></p>
<p>字符过滤器，在一段文本进行分词之前，先进行预处理。</p>
</li>
<li><p><strong>tokenizers：</strong></p>
<p>分词器，英文分词可以根据空格将单词分开,中文分词比较复杂,可以采用机器学习算法来分词。</p>
</li>
<li><p><strong>token filters：</strong></p>
<p>Token过滤器，将切分的单词进行加工。大小写转换（例将“Quick”转为小写)，去掉停用词（例如停用词像“a”、“and”、“the”等等)，加入同义词（例如同义词像”jump”和“leap”)。</p>
</li>
</ul>
<h3 id="内置分词器"><a href="#内置分词器" class="headerlink" title="内置分词器"></a>内置分词器</h3><ul>
<li>Standard Analyzer：默认分词器，按照单词分词英文统一转为小写过滤标点符号中文单字分词，并小写处理</li>
<li>Simple Analyzer：英文按照单词分词英文统一转为小写，去掉符号，中文按照空格分词，小写处理</li>
<li>Stop Analyzer ：小写处理，停用词过滤(the,a,is)</li>
<li>Whitespace Analyzer：中文英文按照空格分词，英文不会转为小写不去掉标点符号，不转小写</li>
<li>Keyword Analyzer：不分词，直接将输入当作输出</li>
</ul>
<blockquote>
<p>如果需要对分词器进行测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /_analyze</span><br><span class="line">&#123;</span><br><span class="line">	&quot;analyzer&quot;:&quot;分词器简名如：standard&quot;,</span><br><span class="line">	&quot;text&quot;: &quot;分词文本&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建索引时设置分词器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PUT /products</span><br><span class="line">&#123;</span><br><span class="line">	&quot;settings&quot;:&#123;</span><br><span class="line">		&quot;number_of_shards&quot;: 1,</span><br><span class="line">		&quot;number_of_replicas&quot;: 0</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;mappings&quot;: &#123;</span><br><span class="line">	  &quot;properties&quot;: &#123;</span><br><span class="line">	    &quot;title&quot;:&#123;</span><br><span class="line">	      &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">	      # 指定分词器</span><br><span class="line">	      &quot;analyzer&quot;:&quot;standard&quot;</span><br><span class="line">	    &#125;</span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="IK分词器"><a href="#IK分词器" class="headerlink" title="IK分词器"></a>IK分词器</h3><p>IK分词器是ES的一个插件，主要用于把一段中文或者英文的划分成一个个的关键字，我们在搜索时候会把自己的信息进行分词，会把数据库中或者索引库中的数据进行分词，然后进行一个匹配操作，默认的中文分词器是将每个字看成一个词。</p>
<h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><ul>
<li>下载IK分词器(<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/releases)%EF%BC%8C%E6%B3%A8%E6%84%8F%E7%89%88%E6%9C%AC%E8%A6%81%E4%B8%8EES%E7%89%88%E6%9C%AC%E4%B8%80%E8%87%B4">https://github.com/medcl/elasticsearch-analysis-ik/releases)，注意版本要与ES版本一致</a></li>
<li>下载后解压上传到docker容器的插件数据卷中：<code>/opt/docker_app/elasticsearch/plugins</code></li>
<li>重启容器</li>
</ul>
<h4 id="测试使用"><a href="#测试使用" class="headerlink" title="测试使用"></a>测试使用</h4><p>IK有两种颗粒度的拆分：</p>
<ul>
<li><code>ik_smart</code>：会做最粗粒度的拆分</li>
<li><code>ik_max_word</code>：会将文本做最细粒度的拆分</li>
</ul>
<p>ik_smart测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /_analyze</span><br><span class="line">&#123;</span><br><span class="line">	&quot;analyzer&quot;:&quot;ik_smart&quot;,</span><br><span class="line">	&quot;text&quot;: &quot;分词文本真的不错&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/image-20220916213726050.png" alt="image-20220916213726050" style="zoom:67%;" />

<p>ik_max_word测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;_analyze</span><br><span class="line">&#123;</span><br><span class="line">	&quot;analyzer&quot;:&quot;ik_max_word&quot;,</span><br><span class="line">	&quot;text&quot;: &quot;分词文本真的不错&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/image-20220916213835329.png" alt="image-20220916213835329" style="zoom:67%;" />

<h4 id="扩展词、停用词配置"><a href="#扩展词、停用词配置" class="headerlink" title="扩展词、停用词配置"></a>扩展词、停用词配置</h4><p>IK分词器支持自定义<code>扩展词典</code>和<code>停用词典</code></p>
<p><strong>扩展词典：</strong>就是有些词并不是关键词,但是也希望被ES用来作为检索的关键词,可以将这些词加入扩展词典。</p>
<p><strong>停用词典：</strong>就是有些词是关键词,但是出于业务场景不想使用这些关键词被检索到，可以将这些词放入停用词典。</p>
<p>定义扩展词典和停用词典可以修改IK分词器中config目录中IKAnalyzer.cfg.xml这个文件。</p>
<h5 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h5><ol>
<li><p>先创建扩展词和停用词的.dic文件（注意文件中一行只能放一个词）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建并输入扩展词</span></span><br><span class="line">vim ext_dict.dic</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建并输入停用词</span></span><br><span class="line">vim ext_stopword.dic</span><br></pre></td></tr></table></figure></li>
<li><p>在IKAnalyzer.cfg.xml中配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim IKAnalyzer.cfg.xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE properties SYSTEM &quot;http://java.sun.com/dtd/properties.dtd&quot;&gt;</span><br><span class="line">&lt;properties&gt;</span><br><span class="line">        &lt;comment&gt;IK Analyzer 扩展配置&lt;/comment&gt;</span><br><span class="line">        &lt;!--用户可以在这里配置自己的扩展字典 --&gt;</span><br><span class="line">        &lt;entry key=&quot;ext_dict&quot;&gt;ext_dict.dic&lt;/entry&gt;</span><br><span class="line">         &lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;</span><br><span class="line">        &lt;entry key=&quot;ext_stopwords&quot;&gt;ext_stopword.dic&lt;/entry&gt;</span><br><span class="line">        &lt;!--用户可以在这里配置远程扩展字典 --&gt;</span><br><span class="line">        &lt;!-- &lt;entry key=&quot;remote_ext_dict&quot;&gt;words_location&lt;/entry&gt; --&gt;</span><br><span class="line">        &lt;!--用户可以在这里配置远程扩展停止词字典--&gt;</span><br><span class="line">        &lt;!-- &lt;entry key=&quot;remote_ext_stopwords&quot;&gt;words_location&lt;/entry&gt; --&gt;</span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure>
<p>3 . 重启es</p>
</li>
</ol>
<blockquote>
<p>当然一般可以使用他所提供的字典：</p>
<ul>
<li>扩展词典：extra_main.dic</li>
<li>停用词典：extra_stopword.dic</li>
</ul>
</blockquote>
<h2 id="整合SpringBoot"><a href="#整合SpringBoot" class="headerlink" title="整合SpringBoot"></a>整合SpringBoot</h2><h3 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="配置客户端"><a href="#配置客户端" class="headerlink" title="配置客户端"></a>配置客户端</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisClientConfig</span> <span class="keyword">extends</span> <span class="title">AbstractElasticsearchConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.elasticsearch.host&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestHighLevelClient <span class="title">elasticsearchClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ClientConfiguration clientConfiguration = ClientConfiguration.builder()</span><br><span class="line">                .connectedTo(host)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> RestClients.create(clientConfiguration).rest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>配置之后，会在spring工厂中创建RestHighLevelClient对象（之前的restful交互方式）和ElasticSearchOperations对象（面向对象的方式）</p>
</blockquote>
<h3 id="客户端对象"><a href="#客户端对象" class="headerlink" title="客户端对象"></a>客户端对象</h3><h4 id="ElasticSearchOperations"><a href="#ElasticSearchOperations" class="headerlink" title="ElasticSearchOperations"></a>ElasticSearchOperations</h4><ul>
<li>特点：以面向对象的方式操作ElasticSearch</li>
</ul>
<p><strong>相关注解：</strong></p>
<ul>
<li>@Document(indexName=”索引名”,createIndex = true)：用在类上，代表一个对象为一个文档<ul>
<li>indexName：指定索引名</li>
<li>createIndex：是否创建索引（不存在则创建）</li>
</ul>
</li>
<li>@Id：用在属性上，指定字段与es文档中_id对应</li>
<li>@Field(type =  FieldType.keyword,analyzer=”ik_max_word”)：用在属性上，描述属性在es中存储类型以及分词情况<ul>
<li>type：用于指定字段类型</li>
<li>analyzer：指定分词器</li>
</ul>
</li>
</ul>
<h5 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h5><ul>
<li><p>文档实体：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Document(indexName = &quot;products&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="meta">@Field(type = FieldType.Keyword)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="meta">@Field(type = FieldType.Float)</span></span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">    <span class="meta">@Field(type = FieldType.Text,analyzer = &quot;ik_max_word&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EsDemoApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ElasticsearchOperations operations;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * save方法如果id不存在则插入，如果id存在则更新</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Product product = <span class="keyword">new</span> Product(<span class="number">1</span>,<span class="string">&quot;可口可乐&quot;</span>,<span class="number">3.5</span>,<span class="string">&quot;可乐很好喝，肥宅快乐水&quot;</span>);</span><br><span class="line">        operations.save(product);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testSearch</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//根据id查询</span></span><br><span class="line">        Product product = operations.get(<span class="string">&quot;1&quot;</span>, Product.class);</span><br><span class="line">        System.out.println(product);</span><br><span class="line">        <span class="comment">//查询所有</span></span><br><span class="line">        SearchHits&lt;Product&gt; searchHits = operations.search(Query.findAll(), Product.class);</span><br><span class="line">        System.out.println(searchHits);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testDel</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//根据id删除</span></span><br><span class="line">        operations.delete(<span class="string">&quot;1&quot;</span>, Product.class);</span><br><span class="line">        <span class="comment">//方式二</span></span><br><span class="line">        Product product = <span class="keyword">new</span> Product();</span><br><span class="line">        product.setId(<span class="number">1</span>);</span><br><span class="line">        operations.delete(product);</span><br><span class="line">        <span class="comment">//删除所有</span></span><br><span class="line">        operations.delete(Query.findAll(),Product.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="RestHighLevelClient"><a href="#RestHighLevelClient" class="headerlink" title="RestHighLevelClient"></a>RestHighLevelClient</h4></li>
<li><p>测试索引操作：</p>
<ul>
<li><p>创建索引：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreateIndexAndMapping</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//参数1：创建索引请求对象，参数2：请求配置对象</span></span><br><span class="line">    CreateIndexRequest createIndexRequest = <span class="keyword">new</span> CreateIndexRequest(<span class="string">&quot;goods&quot;</span>);</span><br><span class="line">    <span class="comment">//指定映射,以json形式</span></span><br><span class="line">    createIndexRequest.mapping(<span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t  \&quot;properties\&quot;: &#123;\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t    \&quot;id\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t      \&quot;type\&quot;: \&quot;integer\&quot;\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t    &#125;,\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t    \&quot;title\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t      \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t    &#125;,\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t    \&quot;price\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t      \&quot;type\&quot;: \&quot;double\&quot;\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t    &#125;,\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t    \&quot;created_at\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t      \&quot;type\&quot;: \&quot;date\&quot;\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t    &#125;,\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t    \&quot;description\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t      \&quot;type\&quot;: \&quot;text\&quot;\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t    &#125;\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t  &#125;\n&quot;</span> +</span><br><span class="line">                               <span class="string">&quot;\t&#125;&quot;</span>, XContentType.JSON);</span><br><span class="line">    CreateIndexResponse createIndexResponse = restHighLevelClient.indices().create(createIndexRequest, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">//查看是否创建成功</span></span><br><span class="line">    System.out.println(createIndexResponse.isAcknowledged());</span><br><span class="line">    restHighLevelClient.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>删除索引：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//参数1：删除索引请求对象，参数2：请求配置对象</span></span><br><span class="line">    AcknowledgedResponse acknowledgedResponse = restHighLevelClient.indices().delete(<span class="keyword">new</span> DeleteIndexRequest(<span class="string">&quot;goods&quot;</span>), RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(acknowledgedResponse.isAcknowledged());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>测试文档操作：</p>
<ul>
<li><p>插入文档：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreateDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//指定索引</span></span><br><span class="line">    IndexRequest indexRequest = <span class="keyword">new</span> IndexRequest(<span class="string">&quot;goods&quot;</span>);</span><br><span class="line">    <span class="comment">//指定文档id</span></span><br><span class="line">    indexRequest.id(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    <span class="comment">//指定文档内容</span></span><br><span class="line">    indexRequest.source(<span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\t\&quot;title\&quot; : \&quot;卫龙小辣棒\&quot;,\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\t\&quot;price\&quot;:6.2,\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\t\&quot;created_at\&quot; : \&quot;2022-09-15\&quot;,\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\t\&quot;description\&quot; : \&quot;辣条\&quot;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;&#125;&quot;</span>, XContentType.JSON);</span><br><span class="line">    IndexResponse response = restHighLevelClient.index(indexRequest, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">//获取插入状态</span></span><br><span class="line">    System.out.println(response.status());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>更新文档：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//指定索引以及id</span></span><br><span class="line">    UpdateRequest updateRequest = <span class="keyword">new</span> UpdateRequest(<span class="string">&quot;goods&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    <span class="comment">//指定修改内容</span></span><br><span class="line">    updateRequest.doc(<span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                      <span class="string">&quot;    \&quot;price\&quot;:4.8\n&quot;</span> +</span><br><span class="line">                      <span class="string">&quot;  &#125;&quot;</span>,XContentType.JSON);</span><br><span class="line">    restHighLevelClient.update(updateRequest,RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>删除文档：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//指定索引以及id</span></span><br><span class="line">    DeleteRequest deleteRequest = <span class="keyword">new</span> DeleteRequest(<span class="string">&quot;goods&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    restHighLevelClient.delete(deleteRequest,RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>基于id查询文档：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryById</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    GetResponse documentFields = restHighLevelClient.get(<span class="keyword">new</span> GetRequest(<span class="string">&quot;goods&quot;</span>,<span class="string">&quot;1&quot;</span>), RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">//获取id</span></span><br><span class="line">    System.out.println(documentFields.getId());</span><br><span class="line">    System.out.println(documentFields.getSourceAsString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>各种查询：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"><span class="comment">//term关键词查询</span></span><br><span class="line">    query(QueryBuilders.termQuery(<span class="string">&quot;description&quot;</span>, <span class="string">&quot;辣&quot;</span>));</span><br><span class="line">    <span class="comment">// range查询</span></span><br><span class="line">    query(QueryBuilders.rangeQuery(<span class="string">&quot;price&quot;</span>).from(<span class="number">0</span>).to(<span class="number">6.5</span>));</span><br><span class="line">    <span class="comment">// match查询</span></span><br><span class="line">    query(QueryBuilders.matchQuery(<span class="string">&quot;description&quot;</span>,<span class="string">&quot;辣条&quot;</span>));</span><br><span class="line">    <span class="comment">// 前缀查询</span></span><br><span class="line">    query(QueryBuilders.prefixQuery(<span class="string">&quot;title&quot;</span>,<span class="string">&quot;卫龙&quot;</span>));</span><br><span class="line">    <span class="comment">// 通配符查询</span></span><br><span class="line">    query(QueryBuilders.wildcardQuery(<span class="string">&quot;title&quot;</span>,<span class="string">&quot;卫龙*&quot;</span>));</span><br><span class="line">    <span class="comment">// ids查询</span></span><br><span class="line">    query(QueryBuilders.idsQuery().addIds(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>));</span><br><span class="line">    <span class="comment">// 多字段查询</span></span><br><span class="line">    query(QueryBuilders.multiMatchQuery(<span class="string">&quot;辣&quot;</span>,<span class="string">&quot;title&quot;</span>,<span class="string">&quot;description&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">(QueryBuilder queryBuilder)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//指定查询索引</span></span><br><span class="line">    SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest(<span class="string">&quot;goods&quot;</span>);</span><br><span class="line">    <span class="comment">//指定查询条件</span></span><br><span class="line">    SearchSourceBuilder sourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">    sourceBuilder.query(queryBuilder);</span><br><span class="line">    searchRequest.source(sourceBuilder);</span><br><span class="line">    SearchResponse response = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">//获取总条数和最大得分</span></span><br><span class="line">    System.out.println(<span class="string">&quot;总条数：&quot;</span> + response.getHits().getTotalHits().value);</span><br><span class="line">    System.out.println(<span class="string">&quot;最大得分：&quot;</span> + response.getHits().getMaxScore());</span><br><span class="line">    <span class="comment">//获取并输出查询数据</span></span><br><span class="line">    SearchHit[] hits = response.getHits().getHits();</span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">        System.out.println(hit.getId());</span><br><span class="line">        System.out.println(hit.getSourceAsString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>分页查询以及排序、指定返回字段、高亮：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">(QueryBuilder queryBuilder)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//指定查询索引</span></span><br><span class="line">    SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest(<span class="string">&quot;goods&quot;</span>);</span><br><span class="line">    <span class="comment">//指定查询条件</span></span><br><span class="line">    SearchSourceBuilder sourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">    <span class="comment">//指定高亮字段</span></span><br><span class="line">    HighlightBuilder highlightBuilder = <span class="keyword">new</span> HighlightBuilder();</span><br><span class="line">    highlightBuilder.requireFieldMatch(<span class="keyword">false</span>).field(<span class="string">&quot;description&quot;</span>).field(<span class="string">&quot;title&quot;</span>).preTags(<span class="string">&quot;&lt;span&gt;&quot;</span>).postTags(<span class="string">&quot;&lt;/span&gt;&quot;</span>);</span><br><span class="line">    sourceBuilder.query(queryBuilder)</span><br><span class="line">        .from(<span class="number">0</span>)</span><br><span class="line">        .size(<span class="number">1</span>)</span><br><span class="line">        .sort(<span class="string">&quot;price&quot;</span>, SortOrder.DESC)</span><br><span class="line">        .fetchSource(<span class="keyword">new</span> String[]&#123;<span class="string">&quot;title&quot;</span>&#125;,<span class="keyword">new</span> String[]&#123;&#125;)</span><br><span class="line">        .highlighter(highlightBuilder);</span><br><span class="line">    searchRequest.source(sourceBuilder);</span><br><span class="line">    SearchResponse response = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">//获取总条数和最大得分</span></span><br><span class="line">    System.out.println(<span class="string">&quot;总条数：&quot;</span> + response.getHits().getTotalHits().value);</span><br><span class="line">    System.out.println(<span class="string">&quot;最大得分：&quot;</span> + response.getHits().getMaxScore());</span><br><span class="line">    <span class="comment">//获取并输出查询数据</span></span><br><span class="line">    SearchHit[] hits = response.getHits().getHits();</span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">        System.out.println(hit.getId());</span><br><span class="line">        System.out.println(hit.getSourceAsString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>过滤查询：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFilterQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest(<span class="string">&quot;goods&quot;</span>);</span><br><span class="line">    SearchSourceBuilder sourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">    sourceBuilder.query(QueryBuilders.matchAllQuery());</span><br><span class="line">    <span class="comment">//设置过滤条件</span></span><br><span class="line">    sourceBuilder.postFilter(QueryBuilders.termQuery(<span class="string">&quot;title&quot;</span>,<span class="string">&quot;卫龙小辣棒&quot;</span>));</span><br><span class="line">    searchRequest.source(sourceBuilder);</span><br><span class="line">    SearchResponse response = restHighLevelClient.search(searchRequest,RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">//获取总条数和最大得分</span></span><br><span class="line">    System.out.println(<span class="string">&quot;总条数：&quot;</span> + response.getHits().getTotalHits().value);</span><br><span class="line">    System.out.println(<span class="string">&quot;最大得分：&quot;</span> + response.getHits().getMaxScore());</span><br><span class="line">    <span class="comment">//获取并输出查询数据</span></span><br><span class="line">    SearchHit[] hits = response.getHits().getHits();</span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">        System.out.println(hit.getId());</span><br><span class="line">        System.out.println(hit.getSourceAsString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>聚合查询：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAggs</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest(<span class="string">&quot;products&quot;</span>);</span><br><span class="line">    SearchSourceBuilder sourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">    sourceBuilder.query(QueryBuilders.matchAllQuery())</span><br><span class="line">        .aggregation(AggregationBuilders.terms(<span class="string">&quot;price_group&quot;</span>).field(<span class="string">&quot;price&quot;</span>))</span><br><span class="line">        .size(<span class="number">0</span>);</span><br><span class="line">    searchRequest.source(sourceBuilder);</span><br><span class="line">    SearchResponse response = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">    Aggregations aggregations = response.getAggregations();</span><br><span class="line">    ParsedDoubleTerms aggregation = aggregations.get(<span class="string">&quot;price_group&quot;</span>);</span><br><span class="line">    List&lt;? extends Terms.Bucket&gt; buckets = aggregation.getBuckets();</span><br><span class="line">    <span class="keyword">for</span> (Terms.Bucket bucket : buckets) &#123;</span><br><span class="line">        System.out.println(bucket.getKey()+<span class="string">&quot; &quot;</span>+bucket.getDocCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>聚合函数为max、min、sum桶中只有一个返回值，则max转化为ParsedMax、min转化为ParsedMin、sum转化为ParsedSum、 avg转化为ParsedAvg</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h2><p>一个集群就是由一个或多个节点组织在一起，它们共同持有整个的数据，并一起提供索引和搜索功能。一个集群由一个唯一的名字标识，这个名字默认就是elasticsearch。这个名字是重要的，因为一个节点只能通过指定某个集群的名字，来加入这个集群。</p>
<p><strong>节点：</strong></p>
<p>一个节点是你集群中的一个服务器，作为集群的一部分，它存储你的数据，参与集群的索引和搜索功能。</p>
<p><strong>分片：</strong></p>
<p>Elasticsearch提供了将索引划分成多份的能力，这些份就叫做分片。当创建一个索引的时候，你可以指定你想要的分片的数量。每个分片本身也是一个功能完善并且独立的“索引”,这个“索引”可以被放置到集群中的任何节点上。</p>
<h3 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h3><p><strong>集群规划：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 三个节点</span><br><span class="line">- node1：web端口9201，tcp端口9301</span><br><span class="line">- node2：web端口9202，tcp端口9302</span><br><span class="line">- node3：web端口9203，tcp端口9303</span><br></pre></td></tr></table></figure>
<ol>
<li><p>依次创建备份数据卷：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 节点1</span></span><br><span class="line">mkdir -p /opt/docker_app/elasticsearch/config_node1</span><br><span class="line">mkdir -p /opt/docker_app/elasticsearch/data_node1</span><br><span class="line">mkdir -p /opt/docker_app/elasticsearch/plugins_node1</span><br><span class="line">echo &quot;http.host: 0.0.0.0&quot;&gt;&gt;/opt/docker_app/elasticsearch/config_node1/elasticsearch.yml</span><br><span class="line"><span class="meta">#</span><span class="bash"> 节点2</span></span><br><span class="line">mkdir -p /opt/docker_app/elasticsearch/config_node2</span><br><span class="line">mkdir -p /opt/docker_app/elasticsearch/data_node2</span><br><span class="line">mkdir -p /opt/docker_app/elasticsearch/plugins_node2</span><br><span class="line">echo &quot;http.host: 0.0.0.0&quot;&gt;&gt;/opt/docker_app/elasticsearch/config_node2/elasticsearch.yml</span><br><span class="line"><span class="meta">#</span><span class="bash"> 节点3</span></span><br><span class="line">mkdir -p /opt/docker_app/elasticsearch/config_node3</span><br><span class="line">mkdir -p /opt/docker_app/elasticsearch/data_node3</span><br><span class="line">mkdir -p /opt/docker_app/elasticsearch/plugins_node3</span><br><span class="line">echo &quot;http.host: 0.0.0.0&quot;&gt;&gt;/opt/docker_app/elasticsearch/config_node3/elasticsearch.yml</span><br></pre></td></tr></table></figure></li>
<li><p>对配置文件进行配置：</p>
<p>node-1</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 指定集群名称 一个集群必须一致</span></span><br><span class="line">cluster.name: es-cluster</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定节点名称 每个节点唯一</span></span><br><span class="line">node.name: node-1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 开放远程连接</span> </span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定使用发布地址进行集群间通信</span></span><br><span class="line">network.publish_host: 192.168.227.130</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定web端口</span></span><br><span class="line">http.port: 9201</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定tcp端口</span></span><br><span class="line">transport.tcp.port: 9301</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定所有节点的tcp通信</span></span><br><span class="line">discovery.seed_hosts: [&quot;192.168.227.130:9301&quot;,&quot;192.168.227.130:9302&quot;,&quot;192.168.227.130:9303&quot;]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定可以初始化集群节点名称</span></span><br><span class="line">cluster.initial_master_nodes: [&quot;node-1&quot;,&quot;node-2&quot;,&quot;node-3&quot;]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 集群最少几个点可用</span></span><br><span class="line">gateway.recover_after_nodes: 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 解决跨域问题</span></span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure>
<p>node-2</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 指定集群名称 一个集群必须一致</span></span><br><span class="line">cluster.name: es-cluster</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定节点名称 每个节点唯一</span></span><br><span class="line">node.name: node-2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 开放远程连接</span> </span><br><span class="line">http.host: 0.0.0.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定使用发布地址进行集群间通信</span></span><br><span class="line">network.publish_host: 192.168.227.130</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定web端口</span></span><br><span class="line">http.port: 9202</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定tcp端口</span></span><br><span class="line">transport.tcp.port: 9302</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定所有节点的tcp通信</span></span><br><span class="line">discovery.seed_hosts: [&quot;192.168.227.130:9301&quot;,&quot;192.168.227.130:9302&quot;,&quot;192.168.227.130:9303&quot;]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定可以初始化集群节点名称</span></span><br><span class="line">cluster.initial_master_nodes: [&quot;node-1&quot;,&quot;node-2&quot;,&quot;node-3&quot;]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 集群最少几个点可用</span></span><br><span class="line">gateway.recover_after_nodes: 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 解决跨域问题</span></span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure>
<p>node-3</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 指定集群名称 一个集群必须一致</span></span><br><span class="line">cluster.name: es-cluster</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定节点名称 每个节点唯一</span></span><br><span class="line">node.name: node-3</span><br><span class="line"><span class="meta">#</span><span class="bash"> 开放远程连接</span> </span><br><span class="line">http.host: 0.0.0.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定使用发布地址进行集群间通信</span></span><br><span class="line">network.publish_host: 192.168.227.130</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定web端口</span></span><br><span class="line">http.port: 9203</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定tcp端口</span></span><br><span class="line">transport.tcp.port: 9303</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定所有节点的tcp通信</span></span><br><span class="line">discovery.seed_hosts: [&quot;192.168.227.130:9301&quot;,&quot;192.168.227.130:9302&quot;,&quot;192.168.227.130:9303&quot;]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定可以初始化集群节点名称</span></span><br><span class="line">cluster.initial_master_nodes: [&quot;node-1&quot;,&quot;node-2&quot;,&quot;node-3&quot;]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 集群最少几个点可用</span></span><br><span class="line">gateway.recover_after_nodes: 2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 解决跨域问题</span></span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure></li>
<li><p>启动各个节点容器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> node-1</span></span><br><span class="line">docker run --name elasticsearch01 -p 9201:9201 -p 9301:9301 -e ES_JAVA_OPTS=&quot;-Xms256m -Xmx256m&quot;  -v /opt/docker_app/elasticsearch/config_node1/elasticsearch.yml:/usr/share/config/elasticsearch.yml -v /opt/docker_app/elasticsearch/data_node1:/usr/share/elasticsearch/data -v /opt/docker_app/elasticsearch/plugins_node1:/usr/share/elasticsearch/plugins  -d elasticsearch:7.14.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> node-2</span></span><br><span class="line">docker run --name elasticsearch02 -p 9202:9202 -p 9302:9302 -e ES_JAVA_OPTS=&quot;-Xms256m -Xmx256m&quot;  -v /opt/docker_app/elasticsearch/config_node2/elasticsearch.yml:/usr/share/config/elasticsearch.yml -v /opt/docker_app/elasticsearch/data_node2:/usr/share/elasticsearch/data -v /opt/docker_app/elasticsearch/plugins_node2:/usr/share/elasticsearch/plugins  -d elasticsearch:7.14.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> node-3</span></span><br><span class="line">docker run --name elasticsearch03 -p 9203:9203 -p 9303:9303 -e ES_JAVA_OPTS=&quot;-Xms256m -Xmx256m&quot;  -v /opt/docker_app/elasticsearch/config_node3/elasticsearch.yml:/usr/share/config/elasticsearch.yml -v /opt/docker_app/elasticsearch/data_node3:/usr/share/elasticsearch/data -v /opt/docker_app/elasticsearch/plugins_node3:/usr/share/elasticsearch/plugins  -d elasticsearch:7.14.0</span><br></pre></td></tr></table></figure></li>
<li><p>查看集群状态：<code>http://192.168.xx.xx:9201/_cat/health?v</code></p>
</li>
</ol>
<h4 id="安装head插件"><a href="#安装head插件" class="headerlink" title="安装head插件"></a>安装head插件</h4><ol>
<li>拉取镜像：<code>docker pull mobz/elasticsearch-head:5</code></li>
<li>创建容器：<code>docker run --name es-head -p 9100:9100 mobz/elasticsearch-head:5</code></li>
<li>访问：<code>http://192.168.xx.xx:9100</code></li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:wht661024@163.com">goMars</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/03/11/%E4%B8%AD%E9%97%B4%E4%BB%B6/Elasticsearch/ElasticSearch/">http://example.com/2023/03/11/%E4%B8%AD%E9%97%B4%E4%BB%B6/Elasticsearch/ElasticSearch/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">goMars的学习随记</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ElasticSearch/">ElasticSearch</a><a class="post-meta__tags" href="/tags/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/">搜索引擎</a></div><div class="post_share"><div class="social-share" data-image="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/yoshiko.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/03/12/%E4%B8%AD%E9%97%B4%E4%BB%B6/Elasticsearch/ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BA/"><img class="prev-cover" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/167858775983.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ELK日志平台搭建</div></div></a></div><div class="next-post pull-right"><a href="/2023/03/10/DevOps/CICD/CICD/"><img class="next-cover" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/souvik-banerjee-OMhubJCrtu0-unsplash.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">CICD</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/03/12/中间件/Elasticsearch/ELK日志平台搭建/" title="ELK日志平台搭建"><img class="cover" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/167858775983.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-12</div><div class="title">ELK日志平台搭建</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/blogphoto2.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">goMars</div><div class="author-info__description">Your only limit is your soul<br>一个正在路上的开发者</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">157</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">83</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">48</div></a></div></div><a class="button--animated" id="card-info-btn" href="javaScript:alert(&quot;喜欢的话,点击Ctrl+D收藏哟~&quot;);"><i class="fab fa-leanpub"></i><span>加入书签</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Iooooot" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/wht661024@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的个人博客哟~随便看看，说不定有你感兴趣的呐..</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ElasticSearch"><span class="toc-number">1.</span> <span class="toc-text">ElasticSearch</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.</span> <span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.1.</span> <span class="toc-text">Docker方式安装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kibana"><span class="toc-number">1.3.</span> <span class="toc-text">Kibana</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.1.</span> <span class="toc-text">Docker安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">设置密码</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AEes%E5%AF%86%E7%A0%81"><span class="toc-number">1.3.1.1.1.</span> <span class="toc-text">设置es密码</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">1.4.</span> <span class="toc-text">核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.1.</span> <span class="toc-text">索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%A0%E5%B0%84"><span class="toc-number">1.4.2.</span> <span class="toc-text">映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3"><span class="toc-number">1.4.3.</span> <span class="toc-text">文档</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.5.</span> <span class="toc-text">基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%93%8D%E4%BD%9C"><span class="toc-number">1.5.1.</span> <span class="toc-text">索引操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E6%93%8D%E4%BD%9C"><span class="toc-number">1.5.2.</span> <span class="toc-text">映射操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C"><span class="toc-number">1.5.3.</span> <span class="toc-text">文档操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.6.</span> <span class="toc-text">高级查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DSL%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.6.1.</span> <span class="toc-text">DSL查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.6.2.</span> <span class="toc-text">过滤查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.6.3.</span> <span class="toc-text">聚合查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">1.7.</span> <span class="toc-text">分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Analysis%E5%92%8CAnalyzer"><span class="toc-number">1.7.1.</span> <span class="toc-text">Analysis和Analyzer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Analyzer%E7%BB%84%E6%88%90"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">Analyzer组成</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">1.7.2.</span> <span class="toc-text">内置分词器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IK%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">1.7.3.</span> <span class="toc-text">IK分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E4%BD%BF%E7%94%A8"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">测试使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E8%AF%8D%E3%80%81%E5%81%9C%E7%94%A8%E8%AF%8D%E9%85%8D%E7%BD%AE"><span class="toc-number">1.7.3.3.</span> <span class="toc-text">扩展词、停用词配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">1.7.3.3.1.</span> <span class="toc-text">配置</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E5%90%88SpringBoot"><span class="toc-number">1.8.</span> <span class="toc-text">整合SpringBoot</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">1.8.1.</span> <span class="toc-text">导入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">1.8.2.</span> <span class="toc-text">配置客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.8.3.</span> <span class="toc-text">客户端对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ElasticSearchOperations"><span class="toc-number">1.8.3.1.</span> <span class="toc-text">ElasticSearchOperations</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">1.8.3.1.1.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RestHighLevelClient"><span class="toc-number">1.8.3.2.</span> <span class="toc-text">RestHighLevelClient</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4"><span class="toc-number">1.9.</span> <span class="toc-text">集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA"><span class="toc-number">1.9.1.</span> <span class="toc-text">搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85head%E6%8F%92%E4%BB%B6"><span class="toc-number">1.9.1.1.</span> <span class="toc-text">安装head插件</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/07/11/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%9F%AD%E6%97%B6%E6%8F%90%E4%BE%9B%E6%80%A7%E8%83%BD%E7%9A%84%E6%96%B9%E6%B3%95/" title="MySQL短时提供性能的方法"><img data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/chiara-f-MI8He1NWPWg-unsplash.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL短时提供性能的方法"/></a><div class="content"><a class="title" href="/2023/07/11/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%9F%AD%E6%97%B6%E6%8F%90%E4%BE%9B%E6%80%A7%E8%83%BD%E7%9A%84%E6%96%B9%E6%B3%95/" title="MySQL短时提供性能的方法">MySQL短时提供性能的方法</a><time datetime="2023-07-11T01:46:01.000Z" title="发表于 2023-07-11 09:46:01">2023-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/09/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E5%B9%BB%E8%AF%BB%E9%97%AE%E9%A2%98/" title="MySQL幻读问题"><img data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/souvik-banerjee-OMhubJCrtu0-unsplash.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL幻读问题"/></a><div class="content"><a class="title" href="/2023/07/09/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E5%B9%BB%E8%AF%BB%E9%97%AE%E9%A2%98/" title="MySQL幻读问题">MySQL幻读问题</a><time datetime="2023-07-09T01:42:47.000Z" title="发表于 2023-07-09 09:42:47">2023-07-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/07/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E4%B8%AD%E6%89%A7%E8%A1%8C%E5%8D%95%E6%9D%A1%E8%AF%AD%E5%8F%A5%E5%BE%88%E6%85%A2%E7%9A%84%E5%9C%BA%E6%99%AF/" title="MySQL中执行单条语句很慢的场景"><img data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/blog04.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL中执行单条语句很慢的场景"/></a><div class="content"><a class="title" href="/2023/07/07/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E4%B8%AD%E6%89%A7%E8%A1%8C%E5%8D%95%E6%9D%A1%E8%AF%AD%E5%8F%A5%E5%BE%88%E6%85%A2%E7%9A%84%E5%9C%BA%E6%99%AF/" title="MySQL中执行单条语句很慢的场景">MySQL中执行单条语句很慢的场景</a><time datetime="2023-07-07T01:50:39.000Z" title="发表于 2023-07-07 09:50:39">2023-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/05/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E4%B8%ADOrderby%E6%98%AF%E6%80%8E%E4%B9%88%E5%B7%A5%E4%BD%9C%E7%9A%84/" title="MySQL中Orderby是怎么工作的"><img data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/168852040328.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL中Orderby是怎么工作的"/></a><div class="content"><a class="title" href="/2023/07/05/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E4%B8%ADOrderby%E6%98%AF%E6%80%8E%E4%B9%88%E5%B7%A5%E4%BD%9C%E7%9A%84/" title="MySQL中Orderby是怎么工作的">MySQL中Orderby是怎么工作的</a><time datetime="2023-07-05T01:18:28.000Z" title="发表于 2023-07-05 09:18:28">2023-07-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/03/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%E5%8F%8Acount-%E6%95%88%E7%8E%87%E9%97%AE%E9%A2%98/" title="MySQL语句执行过程及count(*)效率问题"><img data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/blog48.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL语句执行过程及count(*)效率问题"/></a><div class="content"><a class="title" href="/2023/07/03/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%E5%8F%8Acount-%E6%95%88%E7%8E%87%E9%97%AE%E9%A2%98/" title="MySQL语句执行过程及count(*)效率问题">MySQL语句执行过程及count(*)效率问题</a><time datetime="2023-07-03T11:58:57.000Z" title="发表于 2023-07-03 19:58:57">2023-07-03</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/yoshiko.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023 By goMars</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi,  welcome  to  my  <a  target="_blank" rel="noopener" href="https://iooooot.github.io/">blog</a>!&emsp;I hope you would like it！</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: 'KBFy1paWlEx87r2Jl3UoS67U-gzGzoHsz',
      appKey: '8K8QgLxNaqgswNen2iUidj8W',
      placeholder: '冲冲冲！',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign(initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>