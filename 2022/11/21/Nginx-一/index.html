<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Nginx(一) | goMars的学习随记</title><meta name="keywords" content="Nginx"><meta name="author" content="goMars,wht661024@163.com"><meta name="copyright" content="goMars"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="NginxNginx概念Nginx（“engine x”）一个具有高性能的HTTP和反向代理的WEB服务器，同时也是一个POP3&#x2F;SMTP&#x2F;IMAP代理服务器  HTTP：HTTP是超文本传输协议的缩写，是用于从WEB服务器传输超文本到本地浏览器的传输协议，也是互联网上应用最为广泛的一种网络协议。 反向代理：反向代理服务器位于用户与目标服务器之间，但是对于用户而言，反向代理服务器就相当于目标服务器">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx(一)">
<meta property="og:url" content="http://example.com/2022/11/21/Nginx-%E4%B8%80/index.html">
<meta property="og:site_name" content="goMars的学习随记">
<meta property="og:description" content="NginxNginx概念Nginx（“engine x”）一个具有高性能的HTTP和反向代理的WEB服务器，同时也是一个POP3&#x2F;SMTP&#x2F;IMAP代理服务器  HTTP：HTTP是超文本传输协议的缩写，是用于从WEB服务器传输超文本到本地浏览器的传输协议，也是互联网上应用最为广泛的一种网络协议。 反向代理：反向代理服务器位于用户与目标服务器之间，但是对于用户而言，反向代理服务器就相当于目标服务器">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/ben-kolde-FaPxZ88yZrw-unsplash.jpg">
<meta property="article:published_time" content="2022-11-21T02:01:19.000Z">
<meta property="article:modified_time" content="2022-11-21T02:02:19.861Z">
<meta property="article:author" content="goMars">
<meta property="article:tag" content="Nginx">
<meta property="article:tag" content="服务器">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/ben-kolde-FaPxZ88yZrw-unsplash.jpg"><link rel="shortcut icon" href="/img/favicon2.png"><link rel="canonical" href="http://example.com/2022/11/21/Nginx-%E4%B8%80/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-21 10:02:19'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        })(window)</script><link rel="stylesheet" href="/css/shadow.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/hideCategory.min.css"><meta name="generator" content="Hexo 5.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/blogphoto2.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">112</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">62</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">22</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa-fw fa fa-book"></i><span> 找文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/ben-kolde-FaPxZ88yZrw-unsplash.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">goMars的学习随记</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa-fw fa fa-book"></i><span> 找文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Nginx(一)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-11-21T02:01:19.000Z" title="发表于 2022-11-21 10:01:19">2022-11-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-21T02:02:19.861Z" title="更新于 2022-11-21 10:02:19">2022-11-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Nginx/">Nginx</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h2 id="Nginx-1"><a href="#Nginx-1" class="headerlink" title="Nginx"></a>Nginx</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>Nginx（“engine x”）一个具有高性能的<strong>HTTP</strong>和<strong>反向代理</strong>的<strong>WEB服务器</strong>，同时也是一个<strong>POP3/SMTP/IMAP</strong>代理服务器</p>
<blockquote>
<p><strong>HTTP</strong>：HTTP是超文本传输协议的缩写，是用于从WEB服务器传输超文本到本地浏览器的传输协议，也是互联网上应用最为广泛的一种网络协议。</p>
<p><strong>反向代理</strong>：反向代理服务器位于用户与目标服务器之间，但是对于用户而言，反向代理服务器就相当于目标服务器，即用户直接访问反向代理服务器就可以获得目标服务器的资源。同时，用户不需要知道目标服务器的地址，也无须在用户端作任何设定。（就相当于去代理服务器而不是客户端）</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/image-20220729094609211.png" alt="image-20220729094609211"></p>
<p><strong>POP3/SMTP/IMAP：</strong></p>
<ul>
<li>OP3(Post Offic Protocol 3)邮局协议的第三个版本</li>
<li>SMTP(Simple Mail Transfer Protocol)简单邮件传输协议</li>
<li>IMAP(Internet Mail Access Protocol)交互式邮件存取协议</li>
</ul>
</blockquote>
<h3 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h3><ul>
<li>速度更快、并发更高：Nginx采用了多进程和I/O多路复用(epoll)的底层实现</li>
<li>配置简单，扩展性强：Nginx的设计极具扩展性，它本身就是由很多模块组成，这些模块的使用可以通过配置文件的配置来添加。</li>
<li>高可靠性：Nginx采用的是多进程模式运行，其中有一个master主进程和N多个worker进程，worker进程的数量我们可以手动设置，每个worker进程之间都是相互独立提供服务，并且master主进程可以在某一个worker进程出错时，快速去”拉起”新的worker进程提供服务。</li>
<li>热部署：Nginx也提供了热部署功能，即可以在Nginx不停止的情况下，对Nginx进行文件升级、更新配置和更换日志文件等功能</li>
<li>成本低、BSD许可证</li>
</ul>
<h3 id="常用功能模块"><a href="#常用功能模块" class="headerlink" title="常用功能模块"></a>常用功能模块</h3><ol>
<li>静态资源部署</li>
<li>反向代理</li>
<li>负载均衡（轮询、加权轮询、ip_hash、url_hash、fair）</li>
<li>Web缓存</li>
<li>环境部署（高可用的环境）</li>
<li>用户认证模块…</li>
</ol>
<blockquote>
<p>核心文件：</p>
<ul>
<li>nginx二进制可执行文件</li>
<li>nginx.conf配置文件</li>
<li>error.log错误的日志记录</li>
<li>access.log访问日志记录</li>
</ul>
</blockquote>
<h2 id="Nginx安装"><a href="#Nginx安装" class="headerlink" title="Nginx安装"></a>Nginx安装</h2><p>Nginx的下载<a target="_blank" rel="noopener" href="http://nginx.org/en/download.html">官方网站</a></p>
<h4 id="安装前环境："><a href="#安装前环境：" class="headerlink" title="安装前环境："></a>安装前环境：</h4><p>需要安装GCC编译器、PCRE、zlib、OpenSSL</p>
<p>命令：<code>yum install -y gcc pcre pcre-devel zlib zlib-devel openssl openssl-devel</code></p>
<h4 id="安装方式一：Nginx的源码简单安装"><a href="#安装方式一：Nginx的源码简单安装" class="headerlink" title="安装方式一：Nginx的源码简单安装"></a>安装方式一：Nginx的源码简单安装</h4><p>(1)进入官网查找需要下载版本的链接地址，然后使用wget命令进行下载或者下载好上传到linux上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;nginx.org&#x2F;download&#x2F;nginx-1.16.1.tar.gz</span><br></pre></td></tr></table></figure>
<p>(2)进入目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;mysoft</span><br></pre></td></tr></table></figure>
<p>(3)解压缩</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xzf nginx-1.16.1.tar.gz</span><br></pre></td></tr></table></figure>
<p>(4)进入资源文件中，发现configure</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;configure</span><br></pre></td></tr></table></figure>
<p>(5)编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>
<p>(6)安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure>


<h4 id="安装方式二：yum安装"><a href="#安装方式二：yum安装" class="headerlink" title="安装方式二：yum安装"></a>安装方式二：yum安装</h4><p>使用源码进行简单安装，我们会发现安装的过程比较繁琐，需要提前准备GCC编译器、PCRE兼容正则表达式库、zlib压缩库、OpenSSL安全通信的软件库包，然后才能进行Nginx的安装。</p>
<p>（1）安装yum-utils</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum  install -y yum-utils</span><br></pre></td></tr></table></figure>
<p>（2）添加yum源文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;yum.repos.d&#x2F;nginx.repo</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[nginx-stable]</span><br><span class="line">name&#x3D;nginx stable repo</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;nginx.org&#x2F;packages&#x2F;centos&#x2F;$releasever&#x2F;$basearch&#x2F;</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">enabled&#x3D;1</span><br><span class="line">gpgkey&#x3D;https:&#x2F;&#x2F;nginx.org&#x2F;keys&#x2F;nginx_signing.key</span><br><span class="line">module_hotfixes&#x3D;true</span><br><span class="line"></span><br><span class="line">[nginx-mainline]</span><br><span class="line">name&#x3D;nginx mainline repo</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;nginx.org&#x2F;packages&#x2F;mainline&#x2F;centos&#x2F;$releasever&#x2F;$basearch&#x2F;</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">enabled&#x3D;0</span><br><span class="line">gpgkey&#x3D;https:&#x2F;&#x2F;nginx.org&#x2F;keys&#x2F;nginx_signing.key</span><br><span class="line">module_hotfixes&#x3D;true</span><br></pre></td></tr></table></figure>
<p>（3）查看是否安装成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list | grep nginx</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/1581416861684.png" alt="1581416861684"></p>
<p>（4）使用yum进行安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yun install -y nginx</span><br></pre></td></tr></table></figure>
<p>（5）查看nginx的安装位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where is nginx</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/1581416981939.png" alt="1581416981939"></p>
<p>（6）启动测试</p>
<ul>
<li><p>进入二进制命令目录：<code>cd /usr/local/nginx/sbin</code></p>
</li>
<li><p>启动nginx：<code>./nginx</code></p>
</li>
<li><p>输入ip进入nginx：</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/image-20220812150647433.png" alt="image-20220812150647433"></p>
</li>
</ul>
<h4 id="将Nginx设置为系统服务"><a href="#将Nginx设置为系统服务" class="headerlink" title="将Nginx设置为系统服务"></a>将Nginx设置为系统服务</h4><p>把Nginx应用服务设置成为系统服务，方便对Nginx服务的启动和停止等相关操作，具体实现步骤:</p>
<p>(1) 在<code>/usr/lib/systemd/system</code>目录下添加nginx.service,内容如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx.service</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description&#x3D;nginx web service</span><br><span class="line">Documentation&#x3D;http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;</span><br><span class="line">After&#x3D;network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type&#x3D;forking</span><br><span class="line">PIDFile&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs&#x2F;nginx.pid</span><br><span class="line">ExecStartPre&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -t -c &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx</span><br><span class="line">ExecReload&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -s reload</span><br><span class="line">ExecStop&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -s stop</span><br><span class="line">PrivateTmp&#x3D;true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;default.target</span><br></pre></td></tr></table></figure>
<p>(2)添加完成后如果权限有问题需要进行权限设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 755 &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx.service</span><br></pre></td></tr></table></figure>
<p>(3)使用系统命令来操作Nginx服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">启动: systemctl start nginx</span><br><span class="line">停止: systemctl stop nginx</span><br><span class="line">重启: systemctl restart nginx</span><br><span class="line">重新加载配置文件: systemctl reload nginx</span><br><span class="line">查看nginx状态: systemctl status nginx</span><br><span class="line">开机启动: systemctl enable nginx</span><br></pre></td></tr></table></figure>
<h4 id="将Nginx配置为环境变量"><a href="#将Nginx配置为环境变量" class="headerlink" title="将Nginx配置为环境变量"></a>将Nginx配置为环境变量</h4><p>(1)修改<code>/etc/profile</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;profile</span><br><span class="line">在最后一行添加</span><br><span class="line">export PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin</span><br></pre></td></tr></table></figure>
<p>(2)使之立即生效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>
<p>(3)执行nginx命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -V</span><br></pre></td></tr></table></figure>
<h4 id="安装方式三：docker安装"><a href="#安装方式三：docker安装" class="headerlink" title="安装方式三：docker安装"></a>安装方式三：docker安装</h4><ul>
<li><p>拉镜像：<code>docker pull nginx:xxx</code></p>
</li>
<li><p>创建Nginx配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 创建挂载目录</span><br><span class="line">mkdir -p &#x2F;opt&#x2F;docker_app&#x2F;ngnix&#x2F;conf</span><br><span class="line">mkdir -p &#x2F;opt&#x2F;docker_app&#x2F;ngnix&#x2F;log</span><br><span class="line">mkdir -p &#x2F;opt&#x2F;docker_app&#x2F;ngnix&#x2F;html</span><br></pre></td></tr></table></figure></li>
<li><p>创建容器并复制出配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 生成容器</span><br><span class="line">docker run --name nginx -p 9001:80 -d nginx</span><br><span class="line"># 将容器nginx.conf文件复制到宿主机</span><br><span class="line">docker cp nginx:&#x2F;etc&#x2F;nginx&#x2F;nginx.conf &#x2F;opt&#x2F;docker_app&#x2F;ngnix&#x2F;conf&#x2F;nginx.conf</span><br><span class="line"># 将容器conf.d文件夹下内容复制到宿主机</span><br><span class="line">docker cp nginx:&#x2F;etc&#x2F;nginx&#x2F;conf.d &#x2F;opt&#x2F;docker_app&#x2F;ngnix&#x2F;conf&#x2F;conf.d</span><br><span class="line"># 将容器中的html文件夹复制到宿主机</span><br><span class="line">docker cp nginx:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html &#x2F;opt&#x2F;docker_app&#x2F;ngnix&#x2F;html</span><br></pre></td></tr></table></figure></li>
<li><p>将刚才容器删除：<code>docker rm -f nginx</code></p>
</li>
<li><p>正式创建容器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 80:80 --name nginx --privileged&#x3D;true --restart&#x3D;always -v &#x2F;opt&#x2F;docker_app&#x2F;ngnix&#x2F;conf&#x2F;nginx.conf:&#x2F;etc&#x2F;nginx&#x2F;nginx.conf -v &#x2F;opt&#x2F;docker_app&#x2F;ngnix&#x2F;conf&#x2F;conf.d:&#x2F;etc&#x2F;nginx&#x2F;conf.d -v &#x2F;opt&#x2F;docker_app&#x2F;ngnix&#x2F;log:&#x2F;var&#x2F;log&#x2F;nginx -v &#x2F;opt&#x2F;docker_app&#x2F;ngnix&#x2F;html:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html -d nginx</span><br></pre></td></tr></table></figure></li>
<li><p>浏览器输入ip进行访问</p>
</li>
</ul>
<h2 id="Nginx目录结构"><a href="#Nginx目录结构" class="headerlink" title="Nginx目录结构"></a>Nginx目录结构</h2><p>通过tree命令进行目录结构的查看（注意需要<code>yum install -y tree</code>）</p>
<img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/image-20220812151753138.png" alt="image-20220812151753138" style="zoom: 67%;" />

<ul>
<li><p>fastcgi.conf:fastcgi相关配置文件</p>
</li>
<li><p>fastcgi.conf.default:fastcgi.conf的备份文件</p>
</li>
<li><p>fastcgi_params:fastcgi的参数文件</p>
</li>
<li><p>fastcgi_params.default:fastcgi的参数备份文件</p>
</li>
<li><p>scgi_params:scgi的参数文件</p>
</li>
<li><p>scgi_params.default：scgi的参数备份文件</p>
</li>
<li><p>uwsgi_params:uwsgi的参数文件</p>
</li>
<li><p>uwsgi_params.default:uwsgi的参数备份文件</p>
</li>
<li><p>mime.types:记录的是HTTP协议中的Content-Type的值和文件后缀名的对应关系</p>
</li>
<li><p>mime.types.default:mime.types的备份文件</p>
</li>
<li><p>nginx.conf:这个是Nginx的核心配置文件，这个文件非常重要，也是我们即将要学习的重点</p>
</li>
<li><p>nginx.conf.default:nginx.conf的备份文件</p>
</li>
<li><p>koi-utf、koi-win、win-utf这三个文件都是与编码转换映射相关的配置文件，用来将一种编码转换成另一种编码</p>
</li>
<li><p>html:存放nginx自带的两个静态的html页面</p>
</li>
<li><p>50x.html:访问失败后的失败页面</p>
</li>
<li><p>index.html:成功访问的默认首页</p>
</li>
<li><p>logs:记录入门的文件，当nginx服务器启动后，这里面会有 access.log error.log 和nginx.pid三个文件出现。</p>
</li>
<li><p>sbin:是存放执行程序文件nginx</p>
</li>
<li><p>nginx是用来控制Nginx的启动和停止等相关的命令。</p>
</li>
</ul>
<h2 id="Nginx相关命令"><a href="#Nginx相关命令" class="headerlink" title="Nginx相关命令"></a>Nginx相关命令</h2><h3 id="信号量"><a href="#信号量" class="headerlink" title="信号量"></a>信号量</h3><ul>
<li><p>首先查看：ps -ef | grep nginx</p>
</li>
<li><p>调用命令为<code>kill -signal PID</code></p>
<ol>
<li><p>发送TERM/INT信号给master进程，会将Nginx服务立即关闭。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kill -TERM PID / kill -TERM `cat /usr/local/nginx/logs/nginx.pid`</span><br><span class="line">kill -INT PID / kill -INT `cat /usr/local/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure></li>
<li><p>发送QUIT信号给master进程，master进程会控制所有的work进程不再接收新的请求，等所有请求处理完后，在把进程都关闭掉。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -QUIT PID / kill -TERM `cat /usr/local/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure></li>
<li><p>发送HUP信号给master进程，master进程会把控制旧的work进程不再接收新的请求，等处理完请求后将旧的work进程关闭掉，然后根据nginx的配置文件重新启动新的work进程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -HUP PID / kill -TERM `cat /usr/local/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure></li>
<li><p>发送USR1信号给master进程，告诉Nginx重新开启日志文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -USR1 PID / kill -TERM `cat /usr/local/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure></li>
<li><p>发送USR2信号给master进程，告诉master进程要平滑升级，这个时候，会重新开启对应的master进程和work进程，整个系统中将会有两个master进程，并且新的master进程的PID会被记录在<code>/usr/local/nginx/logs/nginx.pid</code>而之前的旧的master进程PID会被记录在<code>/usr/local/nginx/logs/nginx.pid.oldbin</code>文件中，接着再次发送QUIT信号给旧的master进程，让其处理完请求后再进行关闭</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kill -USR2 PID / kill -USR2 `cat /usr/local/nginx/logs/nginx.pid`</span><br><span class="line"></span><br><span class="line">kill -QUIT PID / kill -QUIT `cat /usr/local/nginx/logs/nginx.pid.oldbin`</span><br></pre></td></tr></table></figure>
<ol start="6">
<li><p>发送WINCH信号给master进程,让master进程控制不让所有的work进程在接收新的请求了，请求处理完后关闭work进程。注意master进程不会被关闭掉</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -WINCH PID /kill -WINCH`cat /usr/local/nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure>
<h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3></li>
</ol>
</li>
</ol>
</li>
</ul>
<p>通过帮助命令查看全部其他命令：<code>nginx -h</code></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/image-20220812155841704.png" alt="image-20220812155841704"></p>
<ul>
<li><p>?和-h:显示帮助信息</p>
</li>
<li><p>-v:打印版本号信息并退出</p>
</li>
<li><p>-V:打印版本号信息和配置信息并退出</p>
</li>
<li><p>-t:测试nginx的配置文件语法是否正确并退出</p>
</li>
<li><p>-T:测试nginx的配置文件语法是否正确并列出用到的配置文件信息然后退出</p>
</li>
<li><p>-q:在配置测试期间禁止显示非错误消息</p>
</li>
<li><p>-s:signal信号，后面可以跟 ：</p>
<ul>
<li>stop[快速关闭，类似于TERM/INT信号的作用]</li>
<li>quit[优雅的关闭，类似于QUIT信号的作用] </li>
<li>reopen[重新打开日志文件类似于USR1信号的作用] </li>
<li>reload[类似于HUP信号的作用]</li>
</ul>
</li>
<li><p>-p:prefix，指定Nginx的prefix路径，(默认为: /usr/local/nginx/)</p>
</li>
<li><p>-c:filename,指定Nginx的配置文件路径,(默认为: conf/nginx.conf)</p>
</li>
<li><p>-g:用来补充Nginx配置文件，向Nginx服务指定启动时应用全局的配置</p>
</li>
</ul>
<h3 id="ngnix更新案例"><a href="#ngnix更新案例" class="headerlink" title="ngnix更新案例"></a>ngnix更新案例</h3><h5 id="使用Nginx安装目录的make命令完成升级"><a href="#使用Nginx安装目录的make命令完成升级" class="headerlink" title="使用Nginx安装目录的make命令完成升级"></a>使用Nginx安装目录的make命令完成升级</h5><p>第一步:将1.14.2版本的sbin目录下的nginx进行备份</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin</span><br><span class="line">mv nginx nginxold</span><br></pre></td></tr></table></figure>
<p>第二步:将Nginx1.16.1安装目录编译后的objs目录下的nginx文件，拷贝到原来<code>/usr/local/nginx/sbin</code>目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~&#x2F;nginx&#x2F;core&#x2F;nginx-1.16.1&#x2F;objs</span><br><span class="line">cp nginx &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin</span><br></pre></td></tr></table></figure>
<p>第三步:进入到安装目录，执行<code>make upgrade</code></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/1581494652284.png" alt="1581494652284"></p>
<p>第四步:查看是否更新成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;nginx -v</span><br></pre></td></tr></table></figure>
<h2 id="Nginx-conf"><a href="#Nginx-conf" class="headerlink" title="Nginx.conf"></a>Nginx.conf</h2><p>大致结构：</p>
<p>默认有三大块：全局块、events块、http块。</p>
<p>http块中可以配置多个server块，每个server块又可以配置多个location块。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">指令名	指令值;  #全局块，主要设置Nginx服务器整体运行的配置指令</span><br><span class="line"></span><br><span class="line">#events块,主要设置,Nginx服务器与用户的网络连接,这一部分对Nginx服务器的性能影响较大</span><br><span class="line">events &#123;	 </span><br><span class="line">    指令名	指令值;</span><br><span class="line">&#125;</span><br><span class="line">#http块，是Nginx服务器配置中的重要部分，代理、缓存、日志记录、第三方模块配置...             </span><br><span class="line">http &#123;		</span><br><span class="line">    指令名	指令值;</span><br><span class="line">    server &#123; #server块，是Nginx配置和虚拟主机相关的内容</span><br><span class="line">        指令名	指令值;</span><br><span class="line">        location &#x2F; &#123; </span><br><span class="line">        #location块，基于Nginx服务器接收请求字符串与location后面的值进行匹配，对特定请求进行处理</span><br><span class="line">            指令名	指令值;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>配置文件的语法规则：</p>
<ol>
<li>配置文件由指令与指令块构成；</li>
<li>每条指令以 <code>;</code> 分号结尾，指令与参数间以空格符号分隔；</li>
<li>指令块以 <code>&#123;&#125;</code> 大括号将多条指令组织在一起；</li>
<li><code>include</code> 语句允许组合多个配置文件以提升可维护性；</li>
<li>使用 <code>#</code> 符号添加注释，提高可读性；</li>
<li>使用 <code>$</code> 符号使用变量；</li>
<li>部分指令的参数支持正则表达式；</li>
</ol>
</blockquote>
<h3 id="全局块"><a href="#全局块" class="headerlink" title="全局块"></a>全局块</h3><h4 id="user指令"><a href="#user指令" class="headerlink" title="user指令"></a>user指令</h4><p>用于配置运行Nginx服务器的worker进程的用户和用户组，默认值为nobody。使用user指令可以指定启动运行工作进程的用户及用户组，这样对于系统的权限访问控制的更加精细，也更加安全。</p>
<p><code>user user [group];</code></p>
<h4 id="work-process指令"><a href="#work-process指令" class="headerlink" title="work process指令"></a>work process指令</h4><p>master_process:用来指定是否开启工作进程。默认值为on</p>
<p><code>master_process on\off;</code></p>
<p>worker_processes:用于配置Nginx生成工作进程的数量，默认为1，这个是Nginx服务器实现并发处理服务的关键所在。理论上来说workder process的值越大，可以支持的并发处理量也越多，但事实上这个值的设定是需要受到来自服务器自身的限制，建议将该值和服务器CPU的内核数保存一致。</p>
<p><code>  worker_processes num/auto;</code></p>
<p>如果将worker_processes设置成2，则会看到如下内容:</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/1581563242526.png" alt="1581563242526"></p>
<h4 id="daemon命令"><a href="#daemon命令" class="headerlink" title="daemon命令"></a>daemon命令</h4><p>daemon：设定Nginx是否以守护进程的方式启动，默认on。</p>
<p>守护式进程是linux后台执行的一种服务进程，特点是独立于控制终端，不会随着终端关闭而停止。</p>
<p><code>daemon on\off;</code></p>
<h4 id="pid命令"><a href="#pid命令" class="headerlink" title="pid命令"></a>pid命令</h4><p>用来配置Nginx当前master进程的进程号ID存储的文件路径，默认为/usr/local/nginx/logs/nginx.pid，（docker中pid在/var/run/nginx.pid）</p>
<p><code>  pid file;</code></p>
<h4 id="error-log命令"><a href="#error-log命令" class="headerlink" title="error_log命令"></a>error_log命令</h4><p>用来配置Nginx的错误日志存放路径，默认为error_log logs/error.log error;同样docker中在/var/log/nginx/error.log</p>
<p><code>error_log  file [日志级别];</code></p>
<blockquote>
<p>其中日志级别的值有：debug|info|notice|warn|error|crit|alert|emerg，这块建议大家设置的时候不要设置成info以下的等级，因为会带来大量的磁盘I/O消耗，影响Nginx的性能。</p>
</blockquote>
<h4 id="include命令"><a href="#include命令" class="headerlink" title="include命令"></a>include命令</h4><p>用来引入其他配置文件，使Nginx的配置更加灵活</p>
<p><code>  include file;</code></p>
<p>例如：默认配置文件 <code>/etc/nginx/nginx.conf</code> 的 http 模块中有一句 <code>include /etc/nginx/conf.d/*.conf</code></p>
<blockquote>
<p>Nginx 有一些常用的全局变量，你可以在配置的任何位置使用它们，如下：</p>
<ol>
<li><code>$host</code>：请求信息中的 <code>Host</code>，如果请求中没有 <code>Host</code> 行，则等于设置的服务器名，不包含端口</li>
<li><code>$request_method</code>：客户端请求类型，如 <code>GET</code>、<code>POST</code></li>
<li><code>$remote_addr</code>：客户端的 <code>IP</code> 地址</li>
<li><code>$args</code>： 请求中的参数</li>
<li><code>$arg_PARAMETER</code>：<code>GET</code> 请求中变量名 PARAMETER 参数的值，例如：<code>$http_user_agent</code>(Uaer-Agent 值)</li>
<li><code>$content_length</code>： 请求头中的 <code>Content-length</code> 字段</li>
<li><code>$http_user_agent</code>：客户端agent信息</li>
<li><code>$http_cookie</code>：客户端cookie信息</li>
<li><code>$remote_addr</code>：客户端的IP地址</li>
<li><code>$remote_port</code>：客户端的端口</li>
<li><code>$http_user_agent</code>：客户端agent信息</li>
<li><code>$server_protocol</code>：请求使用的协议，如 <code>HTTP/1.0</code>、<code>HTTP/1.1</code></li>
<li><code>$server_addr</code>： 服务器地址</li>
<li><code>$server_name</code>：服务器名称</li>
<li><code>$server_port</code>：服务器的端口号</li>
<li><code>$scheme</code>：HTTP 方法（如http，https）</li>
</ol>
</blockquote>
<h3 id="events块"><a href="#events块" class="headerlink" title="events块"></a>events块</h3><h4 id="accept-mutex"><a href="#accept-mutex" class="headerlink" title="accept_mutex"></a>accept_mutex</h4><p>用来设置Nginx网络连接序列化，默认值off</p>
<p><code>accept_mutex on\off;</code></p>
<p>这个配置主要可以用来解决常说的”惊群”问题。大致意思是在某一个时刻，客户端发来一个请求连接，Nginx后台是以多进程的工作模式，也就是说有多个worker进程会被同时唤醒，但是最终只会有一个进程可以获取到连接，如果每次唤醒的进程数目太多，就会影响Nginx的整体性能。如果将上述值设置为on(开启状态)，将会对多个Nginx进程接收连接进行序列号，一个个来唤醒接收，就防止了多个进程对连接的争抢。</p>
<h4 id="multi-accept"><a href="#multi-accept" class="headerlink" title="multi_accept"></a>multi_accept</h4><p>用来设置是否允许同时接收多个网络连接，默认值multi_accept off;</p>
<p>如果multi_accept被禁止了，nginx一个工作进程只能同时接受一个新的连接。否则，一个工作进程可以同时接受所有的新连接</p>
<p><code>  multi_accept on\off;</code></p>
<h4 id="worker-connections"><a href="#worker-connections" class="headerlink" title="worker_connections"></a>worker_connections</h4><p>用来配置单个worker进程最大的连接数,默认值worker_commections 512;</p>
<p>这里的连接数不仅仅包括和前端用户建立的连接数，而是包括所有可能的连接数。另外，number值不能大于操作系统支持打开的最大文件句柄数量。</p>
<p><code>worker_connections number;</code></p>
<h4 id="use"><a href="#use" class="headerlink" title="use"></a>use</h4><p>用来设置Nginx服务器选择哪种事件驱动来处理网络消息。</p>
<p><code>  use method;</code></p>
<p>这些值的选择，我们也可以在编译的时候使用</p>
<p><code>--with-select_module</code>、<code>--without-select_module</code>、</p>
<p><code> --with-poll_module</code>、<code> --without-poll_module</code>来设置是否需要将对应的事件驱动模块编译到Nginx的内核。</p>
<h3 id="http块"><a href="#http块" class="headerlink" title="http块"></a>http块</h3><h4 id="定义MIME-Type"><a href="#定义MIME-Type" class="headerlink" title="定义MIME-Type"></a>定义MIME-Type</h4><p>我们都知道浏览器中可以显示的内容有HTML、XML、GIF等种类繁多的文件、媒体等资源，浏览器为了区分这些资源，就需要使用MIME Type。所以说MIME Type是网络资源的媒体类型。Nginx作为web服务器，也需要能够识别前端请求的资源类型。</p>
<p>在Nginx的配置文件中，默认有两行配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">include mime.types; # docker中在&#x2F;etc&#x2F;nginx&#x2F;mime.types</span><br><span class="line">default_type application&#x2F;octet-stream;</span><br></pre></td></tr></table></figure>
<p>（1）default_type:用来配置Nginx响应前端请求默认的MIME类型。默认值为default_type text/plain；</p>
<p>在default_type之前还有一句<code>include mime.types</code>,include之前我们已经介绍过，相当于把mime.types文件中MIMT类型与相关类型文件的文件后缀名的对应关系加入到当前的配置文件中。</p>
<p><code>default_type mime-type;</code></p>
<blockquote>
<p>案例：有些时候请求某些接口的时候需要返回指定的文本字符串或者json字符串，如果逻辑非常简单或者干脆是固定的字符串，那么可以使用nginx快速实现，这样就不用编写程序响应请求了，可以减少服务器资源占用并且响应性能非常快。</p>
<p>实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;get_text &#123;</span><br><span class="line">	#这里也可以设置成text&#x2F;plain</span><br><span class="line"> default_type text&#x2F;html;</span><br><span class="line"> return 200 &quot;This is nginx&#39;s text&quot;;</span><br><span class="line">&#125;</span><br><span class="line">location &#x2F;get_json&#123;</span><br><span class="line"> default_type application&#x2F;json;</span><br><span class="line"> return 200 &#39;&#123;&quot;name&quot;:&quot;TOM&quot;,&quot;age&quot;:18&#125;&#39;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="自定义服务日志"><a href="#自定义服务日志" class="headerlink" title="自定义服务日志"></a>自定义服务日志</h4><p>Nginx中日志的类型分access.log、error.log。</p>
<p>access.log:用来记录用户所有的访问请求。</p>
<p>error.log:记录nginx本身运行时的错误信息，不会记录用户的访问请求。</p>
<p>Nginx服务器支持对服务日志的格式、大小、输出等进行设置，需要使用到两个指令，分别是access_log和log_format指令。</p>
<p>（1）access_log:用来设置用户访问日志的相关属性，默认值access_log logs/access.log combined;</p>
<p>​    <code>  access_log path[format[buffer=size]]</code></p>
<p>（2）log_format:用来指定日志的输出格式，默认值  log_format combined “…”;</p>
<p>​    <code>  log_format name [escape=default\json\none] string....;</code></p>
<h4 id="其他配置指令"><a href="#其他配置指令" class="headerlink" title="其他配置指令"></a>其他配置指令</h4><p>（1）sendfile:用来设置Nginx服务器是否使用sendfile()传输文件，该属性打开可以大大提高Nginx处理静态资源的性能，并且可以同时配置<code>tcp_nopush on</code>和<code>tcp_nodelay on</code>来提高处理静态资源的性能，默认值：<code>sendfile off;</code></p>
<p><code>  sendfile on\off；</code></p>
<p>（2）keepalive_timeout:用来设置长连接的超时时间，默认值<code>  keepalive_timeout 75s;</code></p>
<p>​    <code>  keepalive_timeout time;</code></p>
<blockquote>
<p>我们都知道HTTP是一种无状态协议，客户端向服务端发送一个TCP请求，服务端响应完毕后断开连接。<br>如何客户端向服务端发送多个请求，每个请求都需要重新创建一次连接，效率相对来说比较多，使用keepalive模式，可以告诉服务器端在处理完一个请求后保持这个TCP连接的打开状态，若接收到来自这个客户端的其他请求，服务端就会利用这个未被关闭的连接，而不需要重新创建一个新连接，提升效率，但是这个连接也不能一直保持，这样的话，连接如果过多，也会是服务端的性能下降，这个时候就需要我们进行设置其的超时时间。</p>
</blockquote>
<p>（3）keepalive_requests:用来设置一个keep-alive连接使用的次数，默认值<code>keepalive_requests 100;</code></p>
<pre><code>  `keepalive_requests number;`
</code></pre>
<h3 id="server块和location块"><a href="#server块和location块" class="headerlink" title="server块和location块"></a>server块和location块</h3><p>server 块可以包含多个 location 块，location 指令用于匹配 uri</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">		# 配置监听端口和主机名称</span><br><span class="line">		listen 8081;</span><br><span class="line">		# 配置的域名</span><br><span class="line">		server_name localhost;</span><br><span class="line">		# 配置请求处理日志存放路径</span><br><span class="line">		access_log &#x2F;home&#x2F;www&#x2F;myweb&#x2F;server1&#x2F;logs&#x2F;access.log server1;</span><br><span class="line">		# 配置错误页面</span><br><span class="line">		error_page 404 &#x2F;404.html;</span><br><span class="line">		# 配置处理&#x2F;server1&#x2F;location1请求的location</span><br><span class="line">		location &#x2F;server1&#x2F;location1&#123;</span><br><span class="line">			root &#x2F;home&#x2F;www&#x2F;myweb;</span><br><span class="line">			index index_sr1_location1.html;</span><br><span class="line">		&#125;</span><br><span class="line">		#配置处理&#x2F;server1&#x2F;location2请求的location</span><br><span class="line">		location &#x2F;server1&#x2F;location2&#123;</span><br><span class="line">			root &#x2F;home&#x2F;www&#x2F;myweb;</span><br><span class="line">			index index_sr1_location2.html;</span><br><span class="line">		&#125;</span><br><span class="line">		#配置错误页面转向</span><br><span class="line">		location &#x3D; &#x2F;404.html &#123;</span><br><span class="line">			root &#x2F;home&#x2F;www&#x2F;myweb;</span><br><span class="line">			index 404.html;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>后文会进行详细介绍</p>
</blockquote>
<h2 id="Nginx静态资源部署"><a href="#Nginx静态资源部署" class="headerlink" title="Nginx静态资源部署"></a>Nginx静态资源部署</h2><h3 id="Nginx静态资源的配置指令"><a href="#Nginx静态资源的配置指令" class="headerlink" title="Nginx静态资源的配置指令"></a>Nginx静态资源的配置指令</h3><h4 id="listen指令"><a href="#listen指令" class="headerlink" title="listen指令"></a>listen指令</h4><p>listen：用来配置监听端口，默认值为listen *:80 | *:8000</p>
<p><code>listen address[:port] [default_server]...;或者listen port [default_server]...;</code></p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">listen 127.0.0.1:8000; &#x2F;&#x2F; listen localhost:8000 监听指定的IP和端口</span><br><span class="line">listen 127.0.0.1;	&#x2F;&#x2F;监听指定IP的所有端口</span><br><span class="line">listen 8000;	&#x2F;&#x2F;监听指定端口上的连接</span><br><span class="line">listen *:8000;	&#x2F;&#x2F;监听指定端口上的连接</span><br></pre></td></tr></table></figure>
<blockquote>
<p>default_server属性是标识符，用来将此虚拟主机设置成默认主机。所谓的默认主机指的是如果没有匹配到对应的address:port，则会默认执行的。如果不指定默认使用的是第一个server。</p>
</blockquote>
<h4 id="server-name指令"><a href="#server-name指令" class="headerlink" title="server_name指令"></a>server_name指令</h4><p>server_name：用来设置虚拟主机服务名称，默认值为server_name  “”;</p>
<p><code>server_name  name ...;</code></p>
<p>三种配合方式：</p>
<ul>
<li>精确匹配：<code>server_name www.123.cn www.1234.cn;</code></li>
<li>使用通配符配置：<code>server_name  *.123.cn    www.1234.*;</code>(需要注意的是通配符不能出现在域名的中间，只能出现在首段或尾段)</li>
<li>使用正则表达式配置：<code>server_name ~^www\.(\w+)\.com$;</code></li>
</ul>
<blockquote>
<p>匹配执行顺序为：</p>
<ol>
<li>准确匹配server_name</li>
<li>通配符在开始时匹配server_name成功</li>
<li>通配符在结束时匹配server_name成功</li>
<li>正则表达式匹配server_name成功</li>
<li>被默认的default_server处理，如果没有指定默认找第一个server</li>
</ol>
</blockquote>
<h4 id="location指令"><a href="#location指令" class="headerlink" title="location指令"></a>location指令</h4><p>location:用来设置请求的URI。</p>
<p><code>location [  =  |   ~  |  ~*   |   ^~   |@ ] uri&#123;...&#125;</code></p>
<p>属性介绍:</p>
<ul>
<li>不带符号，要求必须以指定模式开始</li>
<li>= :  用于不包含正则表达式的uri前，必须与指定的模式精确匹配</li>
<li>^~：用于不含正则表达式的 uri； 前，表示如果该符号后面的字符是最佳匹配，采用该规则，不再进行后续的查找</li>
<li>~ ： 用于表示当前uri中包含了正则表达式，并且区分大小写</li>
<li>~*:  用于表示当前uri中包含了正则表达式，并且不区分大小写</li>
</ul>
<h4 id="root-指令"><a href="#root-指令" class="headerlink" title="root 指令"></a>root 指令</h4><p>root：设置请求的根目录，默认值root html;</p>
<p><code>root path;</code></p>
<h4 id="alias指令"><a href="#alias指令" class="headerlink" title="alias指令"></a>alias指令</h4><p>alias：用来更改location的URI</p>
<p><code>alias path;</code></p>
<blockquote>
<p>alias指令与root指令的区别在于：</p>
<p>root的处理结果是: root路径+location路径<br>alias的处理结果是:使用alias路径替换location路径<br>alias是一个目录别名的定义，root则是最上层目录的含义。<br>如果location路径是以/结尾,则alias也必须是以/结尾，root没有要求</p>
</blockquote>
<h4 id="index指令"><a href="#index指令" class="headerlink" title="index指令"></a>index指令</h4><p>index:设置网站的默认首页，默认值index index.html;</p>
<p><code>  index file ...;</code></p>
<h4 id="error-page指令"><a href="#error-page指令" class="headerlink" title="error_page指令"></a>error_page指令</h4><p>error_page:设置网站的错误页面</p>
<p><code>error_page code ... [=[response]] uri;</code></p>
<p>例子：</p>
<p>（1）可以指定具体跳转的地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	error_page 404 http:&#x2F;&#x2F;www.baidu.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（2）可以指定重定向地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">	error_page 404 &#x2F;50x.html;</span><br><span class="line">	error_page 500 502 503 504 &#x2F;50x.html;</span><br><span class="line">	location &#x3D;&#x2F;50x.html&#123;</span><br><span class="line">		root html;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（3）使用location的@符合完成错误信息展示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">	error_page 404 @jump_to_error;</span><br><span class="line">	location @jump_to_error &#123;</span><br><span class="line">		default_type text&#x2F;plain;</span><br><span class="line">		return 404 &#39;Not Found Page...&#39;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可选项<code>=[response]</code>的作用是用来将相应代码更改为另外一个</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">	error_page 404 &#x3D;200 &#x2F;50x.html;</span><br><span class="line">	location &#x3D;&#x2F;50x.html&#123;</span><br><span class="line">		root html;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">这样的话，当返回404找不到对应的资源的时候，在浏览器上可以看到，最终返回的状态码是200，这块需要注意下，编写error_page后面的内容，404后面需要加空格，200前面不能加空格</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="静态资源优化配置指令"><a href="#静态资源优化配置指令" class="headerlink" title="静态资源优化配置指令"></a>静态资源优化配置指令</h3><h4 id="sendﬁle指令"><a href="#sendﬁle指令" class="headerlink" title="sendﬁle指令"></a>sendﬁle指令</h4><p>sendﬁle：用来开启高效的文件传输模式，默认值为sendﬁle oﬀ;</p>
<p><code>sendﬁle on|oﬀ;</code></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/1587665814562.png" alt="1587665814562"></p>
<h4 id="tcp-nopush指令"><a href="#tcp-nopush指令" class="headerlink" title="tcp_nopush指令"></a>tcp_nopush指令</h4><p>tcp_nopush：该指令必须在sendfile打开的状态下才会生效，主要是用来提升网络包的传输’效率’，默认值为tcp_nopush oﬀ;</p>
<p><code>tcp_nopush on|off;</code></p>
<h4 id="tcp-nodelay指令"><a href="#tcp-nodelay指令" class="headerlink" title="tcp_nodelay指令"></a>tcp_nodelay指令</h4><p>tcp_nodelay：该指令必须在keep-alive连接开启的情况下才生效，来提高网络包传输的’实时性’，默认值为  tcp_nodelay on;</p>
<p><code>  tcp_nodelay on|off;</code></p>
<blockquote>
<p>TCP_NOPUSH可以与TCP_NODELAY一起设置(在linux2.5.9以后的版本中两者是可以兼容的)，它比单独配置TCP_NODELAY具有更强的性能。</p>
</blockquote>
<h3 id="静态资源的压缩"><a href="#静态资源的压缩" class="headerlink" title="静态资源的压缩"></a>静态资源的压缩</h3><h4 id="Gzip模块配置指令"><a href="#Gzip模块配置指令" class="headerlink" title="Gzip模块配置指令"></a>Gzip模块配置指令</h4><h5 id="gzip指令"><a href="#gzip指令" class="headerlink" title="gzip指令"></a>gzip指令</h5><p>gzip指令：该指令用于开启或者关闭gzip功能，默认值为  gzip off;</p>
<p><code>  gzip on|off;</code></p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">   gzip on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="gzip-buffers指令"><a href="#gzip-buffers指令" class="headerlink" title="gzip_buffers指令"></a>gzip_buffers指令</h5><p>gzip_buffers指令：该指令用于处理请求压缩的缓冲区数量和大小。，默认值为  gzip_buffers 32 4k|16 8k;</p>
<p><code>  gzip_buffers number size;;</code></p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gzip_buffers 4 16K;	  #缓存空间大小</span><br></pre></td></tr></table></figure>
<h5 id="gzip-disable指令"><a href="#gzip-disable指令" class="headerlink" title="gzip_disable指令"></a>gzip_disable指令</h5><p>gzip_disable指令：针对不同种类客户端发起的请求，可以选择性地开启和关闭Gzip功能。</p>
<p><code>  gzip_disable regex ...;</code></p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gzip_disable &quot;MSIE [1-6]\.&quot;;</span><br></pre></td></tr></table></figure>
<h5 id="gzip-types指令"><a href="#gzip-types指令" class="headerlink" title="gzip_types指令"></a>gzip_types指令</h5><p>gzip_types指令：该指令可以根据响应页的MIME类型选择性地开启Gzip压缩功能，默认值为  gzip_types text/html;</p>
<p><code>  gzip_types mime-type ...;</code></p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">	gzip_types application&#x2F;javascript;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="gzip-comp-level指令"><a href="#gzip-comp-level指令" class="headerlink" title="gzip_comp_level指令"></a>gzip_comp_level指令</h5><p>gzip_comp_level指令：该指令用于设置Gzip压缩程度，级别从1-9,1表示要是程度最低，要是效率最高，9刚好相反，压缩程度最高，但是效率最低最费时间。，默认值为    gzip_comp_level 1;</p>
<p><code>  gzip_comp_level level;</code></p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">	gzip_comp_level 6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="gzip-vary指令"><a href="#gzip-vary指令" class="headerlink" title="gzip_vary指令"></a>gzip_vary指令</h5><p>gzip_vary指令：该指令用于设置使用Gzip进行压缩发送是否携带“Vary:Accept-Encoding”头域的响应头部。主要是告诉接收方，所发送的数据经过了Gzip压缩处理，默认值为    gzip_vary off;</p>
<p><code>  gzip_vary on|off;</code></p>
<h5 id="gzip-http-version指令"><a href="#gzip-http-version指令" class="headerlink" title="gzip_http_version指令"></a>gzip_http_version指令</h5><p>gzip_http_version指令：针对不同的HTTP协议版本，可以选择性地开启和关闭Gzip功能，默认值为gzip_http_version 1.1;</p>
<p><code>  gzip_http_version 1.0|1.1;</code></p>
<h5 id="gzip-min-length指令"><a href="#gzip-min-length指令" class="headerlink" title="gzip_min_length指令"></a>gzip_min_length指令</h5><p>gzip_min_length指令：该指令针对传输数据的大小，可以选择性地开启和关闭Gzip功能，默认值为      gzip_min_length 20;</p>
<p><code> gzip_min_length length;</code></p>
<h5 id="gzip-proxied指令"><a href="#gzip-proxied指令" class="headerlink" title="gzip_proxied指令"></a>gzip_proxied指令</h5><p>gzip_proxied指令：该指令设置是否对服务端返回的结果进行Gzip压缩，默认值为    gzip_proxied off;</p>
<p><code>  gzip_proxied  off|expired|no-cache|no-store|private|no_last_modified|no_etag|auth|any;</code></p>
<p>属性说明：</p>
<ul>
<li>off - 关闭Nginx服务器对后台服务器返回结果的Gzip压缩</li>
<li>expired - 启用压缩，如果header头中包含 “Expires” 头信息</li>
<li>no-cache - 启用压缩，如果header头中包含 “Cache-Control:no-cache” 头信息</li>
<li>no-store - 启用压缩，如果header头中包含 “Cache-Control:no-store” 头信息</li>
<li>private - 启用压缩，如果header头中包含 “Cache-Control:private” 头信息</li>
<li>no_last_modified - 启用压缩,如果header头中不包含 “Last-Modified” 头信息</li>
<li>no_etag - 启用压缩 ,如果header头中不包含 “ETag” 头信息</li>
<li>auth - 启用压缩 , 如果header头中包含 “Authorization” 头信息</li>
<li>any - 无条件启用压缩</li>
</ul>
<blockquote>
<p>前面在讲解sendfile的时候，提到过，开启sendfile以后，在读取磁盘上的静态资源文件的时候，可以减少拷贝的次数，可以不经过用户进程将静态文件通过网络设备发送出去，但是Gzip要想对资源压缩，是需要经过用户进程进行操作的。</p>
<p>可以使用ngx_http_gzip_static_module模块的gzip_static指令来解决。</p>
<p>安装ngx_http_gzip_static_module</p>
<p>(1)查询当前Nginx的配置参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -V</span><br></pre></td></tr></table></figure>

<p>(2)将nginx安装目录下sbin目录中的nginx二进制文件进行更名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin</span><br><span class="line">mv nginx nginxold</span><br></pre></td></tr></table></figure>

<p>(3) 进入Nginx的安装目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;root&#x2F;nginx&#x2F;core&#x2F;nginx-1.16.1</span><br></pre></td></tr></table></figure>

<p>(4)执行make clean清空之前编译的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br></pre></td></tr></table></figure>

<p>(5)使用configure来配置参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;configure --with-http_gzip_static_module</span><br></pre></td></tr></table></figure>

<p>(6)使用make命令进行编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>

<p>(7) 将objs目录下的nginx二进制执行文件移动到nginx安装目录下的sbin目录中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv objs&#x2F;nginx &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin</span><br></pre></td></tr></table></figure>

<p>(8)执行更新命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make upgrade</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="缓存处理"><a href="#缓存处理" class="headerlink" title="缓存处理"></a>缓存处理</h3><h5 id="Nginx缓存的执行流程"><a href="#Nginx缓存的执行流程" class="headerlink" title="Nginx缓存的执行流程"></a>Nginx缓存的执行流程</h5><p>（1）用户首次通过浏览器发送请求到服务端获取数据，客户端是没有对应的缓存，所以需要发送request请求来获取数据；</p>
<p>（2）服务端接收到请求后，获取服务端的数据及服务端缓存的允许后，返回200的成功状态码并且在响应头上附上对应资源以及缓存信息；</p>
<p>（3）当用户再次访问相同资源的时候，客户端会在浏览器的缓存目录中查找是否存在响应的缓存文件</p>
<p>（4）如果没有找到对应的缓存文件，则走(2)步</p>
<p>（5）如果有缓存文件，接下来对缓存文件是否过期进行判断，过期的判断标准是(Expires),</p>
<p>（6）如果没有过期，则直接从本地缓存中返回数据进行展示</p>
<p>（7）如果Expires过期，接下来需要判断缓存文件是否发生过变化</p>
<p>（8）判断的标准有两个，一个是ETag(Entity Tag),一个是Last-Modified</p>
<p>（9）判断结果是未发生变化，则服务端返回304，直接从缓存文件中获取数据</p>
<p>（10）如果判断是发生了变化，重新从服务端获取数据，并根据缓存协商(服务端所设置的是否需要进行缓存数据的设置)来进行数据缓存。</p>
<h4 id="Nginx缓存相关指令"><a href="#Nginx缓存相关指令" class="headerlink" title="Nginx缓存相关指令"></a>Nginx缓存相关指令</h4><h5 id="expires指令"><a href="#expires指令" class="headerlink" title="expires指令"></a>expires指令</h5><p>expires:该指令用来控制页面缓存的作用。可以通过该指令控制HTTP应答中的“Expires”和”Cache-Control”，默认值为expires off;</p>
<p><code>expires [modified] time</code> 或者<code>expires epoch\|max\|off;</code></p>
<h5 id="add-header指令"><a href="#add-header指令" class="headerlink" title="add_header指令"></a>add_header指令</h5><p>add_header指令是用来添加指定的响应头和响应值。</p>
<p><code>add_header name value [always];</code></p>
<h5 id="Cache-Control指令"><a href="#Cache-Control指令" class="headerlink" title="Cache-Control指令"></a>Cache-Control指令</h5><p>Cache-Control作为响应头信息，可以设置如下值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Cache-control: must-revalidate</span><br><span class="line">Cache-control: no-cache</span><br><span class="line">Cache-control: no-store</span><br><span class="line">Cache-control: no-transform</span><br><span class="line">Cache-control: public</span><br><span class="line">Cache-control: private</span><br><span class="line">Cache-control: proxy-revalidate</span><br><span class="line">Cache-Control: max-age&#x3D;&lt;seconds&gt;</span><br><span class="line">Cache-control: s-maxage&#x3D;&lt;seconds&gt;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>must-revalidate</td>
<td>可缓存但必须再向源服务器进行确认</td>
</tr>
<tr>
<td>no-cache</td>
<td>缓存前必须确认其有效性</td>
</tr>
<tr>
<td>no-store</td>
<td>不缓存请求或响应的任何内容</td>
</tr>
<tr>
<td>no-transform</td>
<td>代理不可更改媒体类型</td>
</tr>
<tr>
<td>public</td>
<td>可向任意方提供响应的缓存</td>
</tr>
<tr>
<td>private</td>
<td>仅向特定用户返回响应</td>
</tr>
<tr>
<td>proxy-revalidate</td>
<td>要求中间缓存服务器对缓存的响应有效性再进行确认</td>
</tr>
<tr>
<td>max-age=&lt;秒&gt;</td>
<td>响应最大Age值</td>
</tr>
<tr>
<td>s-maxage=&lt;秒&gt;</td>
<td>公共缓存服务器响应的最大Age值</td>
</tr>
</tbody></table>
<h3 id="解决跨域问题"><a href="#解决跨域问题" class="headerlink" title="解决跨域问题"></a>解决跨域问题</h3><p>使用add_header指令，该指令可以用来添加一些头信息</p>
<h4 id="具体配置"><a href="#具体配置" class="headerlink" title="具体配置"></a>具体配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;getUser&#123;</span><br><span class="line">    add_header Access-Control-Allow-Origin *;</span><br><span class="line">    add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE;</span><br><span class="line">    default_type application&#x2F;json;</span><br><span class="line">    return 200 &#39;&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;TOM&quot;,&quot;age&quot;:18&#125;&#39;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>重点是需要添加两个头信息，一个是<code>Access-Control-Allow-Origin</code>,<code>Access-Control-Allow-Methods</code></p>
</blockquote>
<h3 id="静态资源防盗链"><a href="#静态资源防盗链" class="headerlink" title="静态资源防盗链"></a>静态资源防盗链</h3><h4 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h4><p>通过valid_referers指令</p>
<p><code>valid_referers none\|blocked\|server_names\|string...</code></p>
<p>属性说明：</p>
<ul>
<li><p>none: 如果Header中的Referer为空，允许访问</p>
</li>
<li><p>blocked:在Header中的Referer不为空，但是该值被防火墙或代理进行伪装过，如不带”http://“ 、”https://“等协议头的资源允许访问。</p>
</li>
<li><p>server_names:指定具体的域名或者IP</p>
</li>
<li><p>string: 可以支持正则表达式和*的字符串。如果是正则表达式，需要以<code>~</code>开头表示，例如</p>
</li>
</ul>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;images &#123;</span><br><span class="line">           valid_referers none blocked www.baidu.com 192.168.200.222 *.example.com example.*  www.example.org  ~\.google\.;</span><br><span class="line">           if ($invalid_referer)&#123;</span><br><span class="line">                return 403;</span><br><span class="line">           &#125;</span><br><span class="line">           root &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>nginx会通就过查看referer自动和valid_referers后面的内容进行匹配，如果匹配到了就将$invalid_referer变量置0，如果没有匹配到，则将$invalid_referer变量置为1，匹配的过程中不区分大小写。</p>
</blockquote>
<h3 id="Rewrite功能"><a href="#Rewrite功能" class="headerlink" title="Rewrite功能"></a>Rewrite功能</h3><p>Rewrite是Nginx服务器提供的一个重要基本功能，是Web服务器产品中几乎必备的功能。主要的作用是用来实现URL的重写。</p>
<h4 id="相关指令"><a href="#相关指令" class="headerlink" title="相关指令"></a>相关指令</h4><h5 id="set指令"><a href="#set指令" class="headerlink" title="set指令"></a>set指令</h5><p>set：该指令用来设置一个新的变量。</p>
<p><code>set $variable value;</code>(变量名称要用”$”作为变量的第一个字符，且不能与Nginx服务器预设的全局变量同名。)</p>
<blockquote>
<p>Rewrite常用全局变量</p>
<table>
<thead>
<tr>
<th>变量</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>$args</td>
<td>变量中存放了请求URL中的请求指令。比如<a target="_blank" rel="noopener" href="http://192.168.200.133:8080/?arg1=value1&amp;args2=value2%E4%B8%AD%E7%9A%84&quot;arg1=value1&amp;arg2=value2&quot;%EF%BC%8C%E5%8A%9F%E8%83%BD%E5%92%8C$query_string%E4%B8%80%E6%A0%B7">http://192.168.200.133:8080?arg1=value1&amp;args2=value2中的&quot;arg1=value1&amp;arg2=value2&quot;，功能和$query_string一样</a></td>
</tr>
<tr>
<td>$http_user_agent</td>
<td>变量存储的是用户访问服务的代理信息(如果通过浏览器访问，记录的是浏览器的相关版本信息)</td>
</tr>
<tr>
<td>$host</td>
<td>变量存储的是访问服务器的server_name值</td>
</tr>
<tr>
<td>$document_uri</td>
<td>变量存储的是当前访问地址的URI。比如<a target="_blank" rel="noopener" href="http://192.168.200.133/server?id=10&amp;name=zhangsan%E4%B8%AD%E7%9A%84&quot;/server&quot;%EF%BC%8C%E5%8A%9F%E8%83%BD%E5%92%8C$uri%E4%B8%80%E6%A0%B7">http://192.168.200.133/server?id=10&amp;name=zhangsan中的&quot;/server&quot;，功能和$uri一样</a></td>
</tr>
<tr>
<td>$document_root</td>
<td>变量存储的是当前请求对应location的root值，如果未设置，默认指向Nginx自带html目录所在位置</td>
</tr>
<tr>
<td>$content_length</td>
<td>变量存储的是请求头中的Content-Length的值</td>
</tr>
<tr>
<td>$content_type</td>
<td>变量存储的是请求头中的Content-Type的值</td>
</tr>
<tr>
<td>$http_cookie</td>
<td>变量存储的是客户端的cookie信息，可以通过add_header Set-Cookie ‘cookieName=cookieValue’来添加cookie数据</td>
</tr>
<tr>
<td>$limit_rate</td>
<td>变量中存储的是Nginx服务器对网络连接速率的限制，也就是Nginx配置中对limit_rate指令设置的值，默认是0，不限制。</td>
</tr>
<tr>
<td>$remote_addr</td>
<td>变量中存储的是客户端的IP地址</td>
</tr>
<tr>
<td>$remote_port</td>
<td>变量中存储了客户端与服务端建立连接的端口号</td>
</tr>
<tr>
<td>$remote_user</td>
<td>变量中存储了客户端的用户名，需要有认证模块才能获取</td>
</tr>
<tr>
<td>$scheme</td>
<td>变量中存储了访问协议</td>
</tr>
<tr>
<td>$server_addr</td>
<td>变量中存储了服务端的地址</td>
</tr>
<tr>
<td>$server_name</td>
<td>变量中存储了客户端请求到达的服务器的名称</td>
</tr>
<tr>
<td>$server_port</td>
<td>变量中存储了客户端请求到达服务器的端口号</td>
</tr>
<tr>
<td>$server_protocol</td>
<td>变量中存储了客户端请求协议的版本，比如”HTTP/1.1”</td>
</tr>
<tr>
<td>$request_body_file</td>
<td>变量中存储了发给后端服务器的本地文件资源的名称</td>
</tr>
<tr>
<td>$request_method</td>
<td>变量中存储了客户端的请求方式，比如”GET”,”POST”等</td>
</tr>
<tr>
<td>$request_filename</td>
<td>变量中存储了当前请求的资源文件的路径名</td>
</tr>
<tr>
<td>$request_uri</td>
<td>变量中存储了当前请求的URI，并且携带请求参数，比如<a target="_blank" rel="noopener" href="http://192.168.200.133/server?id=10&amp;name=zhangsan%E4%B8%AD%E7%9A%84&quot;/server?id=10&amp;name=zhangsan&quot;">http://192.168.200.133/server?id=10&amp;name=zhangsan中的&quot;/server?id=10&amp;name=zhangsan&quot;</a></td>
</tr>
</tbody></table>
</blockquote>
<h5 id="if指令"><a href="#if指令" class="headerlink" title="if指令"></a>if指令</h5><p>if：该指令用来支持条件判断，并根据条件判断结果选择不同的Nginx配置。</p>
<p><code>if  (condition)&#123;...&#125;</code></p>
<p>支持写法：</p>
<ol>
<li>变量名。如果变量名对应的值为空或者是0，if都判断为false,其他条件为true。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if ($param)&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2. 使用&quot;&#x3D;&quot;和&quot;!&#x3D;&quot;比较变量和字符串是否相等，满足条件为true，不满足为false</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if ($request_method &#x3D; POST)&#123;</span><br><span class="line">	return 405;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：此处和Java不太一样的地方是字符串不需要添加引号。</p>
<ol start="3">
<li><p>使用正则表达式对变量进行匹配，匹配成功返回true，否则返回false。变量与正则表达式之间使用”<del>“,”</del><em>“,”!<del>“,”!</del>\</em>“来连接。</p>
<p>“~”代表匹配正则表达式过程中区分大小写，</p>
<p>“~*“代表匹配正则表达式过程中不区分大小写</p>
<p>“!<del>“和”!</del>*“刚好和上面取相反值，如果匹配上返回false,匹配不上返回true</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if ($http_user_agent ~ MSIE)&#123;</span><br><span class="line">	#$http_user_agent的值中是否包含MSIE字符串，如果包含返回true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：正则表达式字符串一般不需要加引号，但是如果字符串中包含”}”或者是”;”等字符时，就需要把引号加上。</p>
<ol start="4">
<li><p>判断请求的文件是否存在使用”-f”和”!-f”,</p>
<p>当使用”-f”时，如果请求的文件存在返回true，不存在返回false。</p>
<p>当使用”!f”时，如果请求文件不存在，但该文件所在目录存在返回true,文件和目录都不存在返回false,如果文件存在返回false</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if (-f $request_filename)&#123;</span><br><span class="line">	#判断请求的文件是否存在</span><br><span class="line">&#125;</span><br><span class="line">if (!-f $request_filename)&#123;</span><br><span class="line">	#判断请求的文件是否不存在</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li><p>判断请求的目录是否存在使用”-d”和”!-d”,</p>
<p>当使用”-d”时，如果请求的目录存在，if返回true，如果目录不存在则返回false</p>
<p>当使用”!-d”时，如果请求的目录不存在但该目录的上级目录存在则返回true，该目录和它上级目录都不存在则返回false,如果请求目录存在也返回false.</p>
</li>
<li><p>判断请求的目录或者文件是否存在使用”-e”和”!-e”</p>
<p>当使用”-e”,如果请求的目录或者文件存在时，if返回true,否则返回false.</p>
<p>当使用”!-e”,如果请求的文件和文件所在路径上的目录都不存在返回true,否则返回false</p>
</li>
<li><p>判断请求的文件是否可执行使用”-x”和”!-x”</p>
<p>当使用”-x”,如果请求的文件可执行，if返回true,否则返回false</p>
<p>当使用”!-x”,如果请求文件不可执行，返回true,否则返回false</p>
</li>
</ol>
<h5 id="break指令"><a href="#break指令" class="headerlink" title="break指令"></a>break指令</h5><p>break：该指令用于中断当前相同作用域中的其他Nginx配置。与该指令处于同一作用域的Nginx配置中，位于它前面的指令配置生效，位于后面的指令配置无效。</p>
<p>例子：</p>
<figure class="highlight plain"><figcaption><span>/&#123;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;&#123;</span><br><span class="line">	if ($param)&#123;</span><br><span class="line">		set $id $1;</span><br><span class="line">		break;</span><br><span class="line">		limit_rate 10k;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="return指令"><a href="#return指令" class="headerlink" title="return指令"></a>return指令</h5><p>return：该指令用于完成对请求的处理，直接向客户端返回响应状态代码。在return后的所有Nginx配置都是无效的。</p>
<p><code>return code [text];</code>或者<code>return code URL;</code>或者<code>return URL;</code></p>
<p>属性说明：</p>
<ul>
<li><p>code:为返回给客户端的HTTP状态代理。可以返回的状态代码为0~999的任意HTTP状态代理</p>
</li>
<li><p>text:为返回给客户端的响应体内容，支持变量的使用</p>
</li>
<li><p>URL:为返回给客户端的URL地址</p>
</li>
</ul>
<h5 id="rewrite指令"><a href="#rewrite指令" class="headerlink" title="rewrite指令"></a>rewrite指令</h5><p>rewrite：该指令通过正则表达式的使用来改变URI。可以同时存在一个或者多个指令，按照顺序依次对URL进行匹配和处理。</p>
<p><code>rewrite regex replacement [flag];</code></p>
<p>属性说明：</p>
<ul>
<li><p>regex:用来匹配URI的正则表达式</p>
</li>
<li><p>replacement:匹配成功后，用于替换URI中被截取内容的字符串。如果该字符串是以”http://“或者”https://“开头的，则不会继续向下对URI进行其他处理，而是直接返回重写后的URI给客户端。</p>
</li>
<li><p>flag:用来设置rewrite对URI的处理行为，可选值有如下：</p>
<ul>
<li>last：终止继续在本location块中处理接收到的URI，并将此处重写的URI作为一个新的URI，使用各location块进行处理。该标志将重写后的URI重写在server块中执行，为重写后的URI提供了转入到其他location块的机会。</li>
<li>break：将此处重写的URI作为一个新的URI,在本块中继续进行处理。该标志将重写后的地址在当前的location块中执行，不会将新的URI转向其他的location块。</li>
<li>redirect：将重写后的URI返回给客户端，状态码为302，指明是临时重定向URl,主要用在replacement变量不是以”http:/“或者”https:/“”开头的情况。</li>
<li>permanent：将重写后的URI返回给客户端，状态码为301，指明是临时重定向URl,主要用在replacement变量不是以”http:/“或者”https://“开头的情况。</li>
</ul>
</li>
</ul>
<h5 id="rewrite-log指令"><a href="#rewrite-log指令" class="headerlink" title="rewrite_log指令"></a>rewrite_log指令</h5><p>rewrite_log：该指令配置是否开启URL重写日志的输出功能。</p>
<p><code>  rewrite_log on|off;</code>(开启后，URL重写的相关日志将以notice级别输出到error_log指令配置的日志文件汇总。)</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:wht661024@163.com">goMars</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/11/21/Nginx-%E4%B8%80/">http://example.com/2022/11/21/Nginx-%E4%B8%80/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">goMars的学习随记</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Nginx/">Nginx</a><a class="post-meta__tags" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a></div><div class="post_share"><div class="social-share" data-image="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/ben-kolde-FaPxZ88yZrw-unsplash.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/11/23/Nginx-%E4%BA%8C-%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1/"><img class="prev-cover" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/nathan-fertig-FBXuXp57eM0-unsplash.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Nginx(二)代理服务</div></div></a></div><div class="next-post pull-right"><a href="/2022/11/11/Swagger2/"><img class="next-cover" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/christopher-gower-vjMgqUkS8q8-unsplash.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Swagger2</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/11/23/Nginx-二-代理服务/" title="Nginx(二)代理服务"><img class="cover" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/nathan-fertig-FBXuXp57eM0-unsplash.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-23</div><div class="title">Nginx(二)代理服务</div></div></a></div><div><a href="/2022/11/24/nginx-三-负载均衡/" title="nginx(三)负载均衡"><img class="cover" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/souvik-banerjee-OMhubJCrtu0-unsplash.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-24</div><div class="title">nginx(三)负载均衡</div></div></a></div><div><a href="/2022/11/28/nginx-五-动静分离/" title="nginx(五)动静分离"><img class="cover" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/christopher-gower-vjMgqUkS8q8-unsplash.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-28</div><div class="title">nginx(五)动静分离</div></div></a></div><div><a href="/2022/11/29/nginx-六-制作下载站点/" title="nginx(六)制作下载站点"><img class="cover" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/jon-tyson-XzUMBNmQro0-unsplash.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-29</div><div class="title">nginx(六)制作下载站点</div></div></a></div><div><a href="/2022/11/26/nginx-四-缓存集成/" title="nginx(四)缓存集成"><img class="cover" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/ben-kolde-FaPxZ88yZrw-unsplash.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-26</div><div class="title">nginx(四)缓存集成</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/blogphoto2.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">goMars</div><div class="author-info__description">Your only limit is your soul<br>一个正在路上的开发者</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">112</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">62</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">22</div></a></div></div><a class="button--animated" id="card-info-btn" href="javaScript:alert(&quot;喜欢的话,点击Ctrl+D收藏哟~&quot;);"><i class="fab fa-leanpub"></i><span>加入书签</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Iooooot" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/wht661024@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的个人博客哟~随便看看，说不定有你感兴趣的呐..</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Nginx"><span class="toc-number">1.</span> <span class="toc-text">Nginx</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx-1"><span class="toc-number">1.1.</span> <span class="toc-text">Nginx</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E7%82%B9%EF%BC%9A"><span class="toc-number">1.1.2.</span> <span class="toc-text">优点：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.3.</span> <span class="toc-text">常用功能模块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.</span> <span class="toc-text">Nginx安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%89%8D%E7%8E%AF%E5%A2%83%EF%BC%9A"><span class="toc-number">1.2.0.1.</span> <span class="toc-text">安装前环境：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9ANginx%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.0.2.</span> <span class="toc-text">安装方式一：Nginx的源码简单安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9Ayum%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.0.3.</span> <span class="toc-text">安装方式二：yum安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86Nginx%E8%AE%BE%E7%BD%AE%E4%B8%BA%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.2.0.4.</span> <span class="toc-text">将Nginx设置为系统服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86Nginx%E9%85%8D%E7%BD%AE%E4%B8%BA%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">1.2.0.5.</span> <span class="toc-text">将Nginx配置为环境变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F%E4%B8%89%EF%BC%9Adocker%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.0.6.</span> <span class="toc-text">安装方式三：docker安装</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">Nginx目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.</span> <span class="toc-text">Nginx相关命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7%E9%87%8F"><span class="toc-number">1.4.1.</span> <span class="toc-text">信号量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.2.</span> <span class="toc-text">命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ngnix%E6%9B%B4%E6%96%B0%E6%A1%88%E4%BE%8B"><span class="toc-number">1.4.3.</span> <span class="toc-text">ngnix更新案例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Nginx%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95%E7%9A%84make%E5%91%BD%E4%BB%A4%E5%AE%8C%E6%88%90%E5%8D%87%E7%BA%A7"><span class="toc-number">1.4.3.0.1.</span> <span class="toc-text">使用Nginx安装目录的make命令完成升级</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx-conf"><span class="toc-number">1.5.</span> <span class="toc-text">Nginx.conf</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%9D%97"><span class="toc-number">1.5.1.</span> <span class="toc-text">全局块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#user%E6%8C%87%E4%BB%A4"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">user指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#work-process%E6%8C%87%E4%BB%A4"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">work process指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#daemon%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">daemon命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pid%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.1.4.</span> <span class="toc-text">pid命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#error-log%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.1.5.</span> <span class="toc-text">error_log命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#include%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.1.6.</span> <span class="toc-text">include命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#events%E5%9D%97"><span class="toc-number">1.5.2.</span> <span class="toc-text">events块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#accept-mutex"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">accept_mutex</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#multi-accept"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">multi_accept</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#worker-connections"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">worker_connections</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#use"><span class="toc-number">1.5.2.4.</span> <span class="toc-text">use</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E5%9D%97"><span class="toc-number">1.5.3.</span> <span class="toc-text">http块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89MIME-Type"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">定义MIME-Type</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9C%8D%E5%8A%A1%E6%97%A5%E5%BF%97"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">自定义服务日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE%E6%8C%87%E4%BB%A4"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">其他配置指令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#server%E5%9D%97%E5%92%8Clocation%E5%9D%97"><span class="toc-number">1.5.4.</span> <span class="toc-text">server块和location块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E9%83%A8%E7%BD%B2"><span class="toc-number">1.6.</span> <span class="toc-text">Nginx静态资源部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9A%84%E9%85%8D%E7%BD%AE%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.1.</span> <span class="toc-text">Nginx静态资源的配置指令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#listen%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">listen指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#server-name%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">server_name指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#location%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">location指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#root-%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.1.4.</span> <span class="toc-text">root 指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#alias%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.1.5.</span> <span class="toc-text">alias指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#index%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.1.6.</span> <span class="toc-text">index指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#error-page%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.1.7.</span> <span class="toc-text">error_page指令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E4%BC%98%E5%8C%96%E9%85%8D%E7%BD%AE%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.2.</span> <span class="toc-text">静态资源优化配置指令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#send%EF%AC%81le%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">sendﬁle指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tcp-nopush%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">tcp_nopush指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tcp-nodelay%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.2.3.</span> <span class="toc-text">tcp_nodelay指令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9A%84%E5%8E%8B%E7%BC%A9"><span class="toc-number">1.6.3.</span> <span class="toc-text">静态资源的压缩</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Gzip%E6%A8%A1%E5%9D%97%E9%85%8D%E7%BD%AE%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">Gzip模块配置指令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#gzip%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.3.1.1.</span> <span class="toc-text">gzip指令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#gzip-buffers%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.3.1.2.</span> <span class="toc-text">gzip_buffers指令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#gzip-disable%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.3.1.3.</span> <span class="toc-text">gzip_disable指令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#gzip-types%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.3.1.4.</span> <span class="toc-text">gzip_types指令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#gzip-comp-level%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.3.1.5.</span> <span class="toc-text">gzip_comp_level指令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#gzip-vary%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.3.1.6.</span> <span class="toc-text">gzip_vary指令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#gzip-http-version%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.3.1.7.</span> <span class="toc-text">gzip_http_version指令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#gzip-min-length%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.3.1.8.</span> <span class="toc-text">gzip_min_length指令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#gzip-proxied%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.3.1.9.</span> <span class="toc-text">gzip_proxied指令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E5%A4%84%E7%90%86"><span class="toc-number">1.6.4.</span> <span class="toc-text">缓存处理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Nginx%E7%BC%93%E5%AD%98%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.6.4.0.1.</span> <span class="toc-text">Nginx缓存的执行流程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nginx%E7%BC%93%E5%AD%98%E7%9B%B8%E5%85%B3%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.4.1.</span> <span class="toc-text">Nginx缓存相关指令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#expires%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.4.1.1.</span> <span class="toc-text">expires指令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#add-header%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.4.1.2.</span> <span class="toc-text">add_header指令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Cache-Control%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.4.1.3.</span> <span class="toc-text">Cache-Control指令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-number">1.6.5.</span> <span class="toc-text">解决跨域问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">具体配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E9%98%B2%E7%9B%97%E9%93%BE"><span class="toc-number">1.6.6.</span> <span class="toc-text">静态资源防盗链</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.6.6.1.</span> <span class="toc-text">具体实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rewrite%E5%8A%9F%E8%83%BD"><span class="toc-number">1.6.7.</span> <span class="toc-text">Rewrite功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.7.1.</span> <span class="toc-text">相关指令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#set%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.7.1.1.</span> <span class="toc-text">set指令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#if%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.7.1.2.</span> <span class="toc-text">if指令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#break%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.7.1.3.</span> <span class="toc-text">break指令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#return%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.7.1.4.</span> <span class="toc-text">return指令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#rewrite%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.7.1.5.</span> <span class="toc-text">rewrite指令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#rewrite-log%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.7.1.6.</span> <span class="toc-text">rewrite_log指令</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/03/11/ElasticSearch/" title="ElasticSearch"><img data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/yoshiko.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ElasticSearch"/></a><div class="content"><a class="title" href="/2023/03/11/ElasticSearch/" title="ElasticSearch">ElasticSearch</a><time datetime="2023-03-11T01:43:33.000Z" title="发表于 2023-03-11 09:43:33">2023-03-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/10/CICD/" title="CICD"><img data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/souvik-banerjee-OMhubJCrtu0-unsplash.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CICD"/></a><div class="content"><a class="title" href="/2023/03/10/CICD/" title="CICD">CICD</a><time datetime="2023-03-10T02:20:56.000Z" title="发表于 2023-03-10 10:20:56">2023-03-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/12/RabbitMQ%E9%9B%86%E7%BE%A4/" title="RabbitMQ集群"><img data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/carl-heyerdahl-KE0nC8-58MQ-unsplash.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RabbitMQ集群"/></a><div class="content"><a class="title" href="/2023/02/12/RabbitMQ%E9%9B%86%E7%BE%A4/" title="RabbitMQ集群">RabbitMQ集群</a><time datetime="2023-02-12T02:15:28.000Z" title="发表于 2023-02-12 10:15:28">2023-02-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/05/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" title="消息队列"><img data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/souvik-banerjee-OMhubJCrtu0-unsplash.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="消息队列"/></a><div class="content"><a class="title" href="/2023/02/05/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" title="消息队列">消息队列</a><time datetime="2023-02-05T03:13:49.000Z" title="发表于 2023-02-05 11:13:49">2023-02-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/04/MongoDB/" title="MongoDB"><img data-lazy-src="https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/georgie-cobbs-bKjHgo_Lbpo-unsplash.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MongoDB"/></a><div class="content"><a class="title" href="/2023/01/04/MongoDB/" title="MongoDB">MongoDB</a><time datetime="2023-01-04T03:44:22.000Z" title="发表于 2023-01-04 11:44:22">2023-01-04</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/ben-kolde-FaPxZ88yZrw-unsplash.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023 By goMars</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi,  welcome  to  my  <a  target="_blank" rel="noopener" href="https://iooooot.github.io/">blog</a>!&emsp;I hope you would like it！</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: 'KBFy1paWlEx87r2Jl3UoS67U-gzGzoHsz',
      appKey: '8K8QgLxNaqgswNen2iUidj8W',
      placeholder: '冲冲冲！',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign(initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>